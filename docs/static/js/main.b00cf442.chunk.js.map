{"version":3,"sources":["components/GridHeaderRow.js","components/EditNumericCell.js","components/GridRow.js","components/GridRowTotals.js","components/AddTicker.js","components/AddTag.js","components/AddTransaction.js","components/TransactionLog.js","components/DeleteTag.js","components/MyPerformance.js","components/StatusMessages.js","components/WhatIf.js","components/InputForms.js","ComparingStocks.js","index.js"],"names":["GridHeaderRow","props","onHeaderCellClick","bind","styleCell","column_index","column_name","classes","startsWith","this","on_change_whatif_format","on_change_sort","is_aggregate","sort_column","sort_triangle","symbol_count_str","all_columns","first_column","name","push","self","columns","forEach","column","new_column","whatif_format","display_name","replace","highlight_column","map","i","key","String","fromCharCode","className","onClick","e","undefined","React","Component","EditNumericCell","state","user_value","user_value_is_valid","handleEscapeKey","handleChange","handleSubmit","isNaN","original_value","setState","elem","focus","document","addEventListener","removeEventListener","event","keyCode","on_escape_key","target","value","length","preventDefault","on_new_value","onSubmit","ref","type","id","onChange","size","disabled","GridRow","hovering_symbol","hovering_risk_factor","user_risk_factor","user_risk_factor_valid","formatDate","onWhatifCellClick","toggleHoverSymbol","toggleHoverRiskFactor","populateMemberButton","populateDeleteButton","populateEditButton","editRiskFactor","onNewValue","populateCellValue","numberWithCommas","daysAgo","epoch","d","Date","month","getMonth","day","getDate","year","getFullYear","join","symbol","is_aggr","row_name","on_remove_from_tag","special_classes","includes","membership_set","on_delete_tag","current_shares","on_delete_ticker","editing_row","on_edit_cell","change_pct","performance","performance_numbers","baseline","short_change_pct","style_realized_performance","start_date","show_only_achieved_performance","medium_change_pct","long_change_pct","new_value","on_modify_risk_factor","current_edit_value","num_decimals","baseline_value","prefix","suffix","adjust_decimal","performance_value","total_value","total_basis","current_price","current_value","risk_factor","visible_risk_factor","percent_value","percent_basis","percent_profit","value_at_risk","basis","basis_risked","realized_gains","whatif","quote_date","risk_factor_modified","parseInt","volume","hasOwnProperty","Math","pow","scaling_power","toString","indexOf","round","toFixed","abs","x","date_str","now","then","diff","row_classes","special_class","member_count","sort","onMouseEnter","onMouseLeave","defaultProps","GridRowTotals","total_performance","styleTotalsCell","populateTotalsCellValue","AddTicker","user_tickers_string","add_to_tag","handleTickersChange","handleTagChange","handleReset","validateTickers","user_tag","user_tickers","split","str","trim","toUpperCase","Array","from","Set","tag","tickers","tickers_to_add","new_status_messages","create_message","ticker","all_stocks","all_tags","tagged_tickers","Object","keys","concat","on_new_tickers","on_new_messages","onReset","placeholder","required","filter","tag_name","AddTag","user_tags_string","validateTags","user_tags","toLowerCase","tags","tags_to_add","on_new_tags","AddTransaction","transaction_date","transaction","user_cash_action","user_cash_amount","validateTransaction","handleCashChange","handleCashReset","handleActionChange","handleCashSubmit","user_date","parseFloat","valid_transaction_summary","on_new_cash","user_transaction","action","num_shares","total","on_new_transaction","TransactionLog","exportRef","createRef","importRef","filter_str","file","onExportButton","onHiddenImportChange","exported_json","transactions","JSON","parse","stringify","all_transactions","risk","all_risk","data","encodeURIComponent","a","createElement","href","download","innerHTML","current","appendChild","click","remove","files","reader","FileReader","readAsText","onload","evt","file_contents","result","on_import_transactions","sorted_filtered_transactions","summary","b","accept","style","width","visibility","modified_at","on_delete_transaction","DeleteTag","delete_tag","MyPerformance","quarter_data","error_message","generateQuarterData","formatCurrency","getDisplayedPerformance","getMonthEndQuote","getYear","getQuarter","formatPerformance","formatWholePercentage","sorted_transactions","date","start_baselinequote","start_baselineprice","prev_quote_month","prev_quote_year","first_year","first_quarter","floor","today","today_year","today_month","today_quarter","quarters_of_performance","console","log","price","start_shares","start_tickervalue","start_totalvalue","q","new_quarter","quarter","end_shares","end_cash","end_transfersinvalue","end_tickervalue","end_totalvalue","assign","target_year","quarter_transactions","t","shares","cash_delta","share_delta","end_tickerdate","this_quote_month","this_quote_year","lastavailablequote_month_str","lastavailablequote_year_str","quote_dates","entries","position","all_monthly_quotes","monthly_dates_desc","reverse","lastavailablequote_month","lastavailablequote_year","month_end_quote","end_baselineprice","end_baselinedate","end_baselinequote","adjusted_transfer_value","zb_start_month","period_start_date","period_end_date","period_days","transactions_of_cash","fraction_of_period","transfer_date","dollars","retval","qoq_baseline_change_pct","my_perf","qoq_change_pct","baseline_perf","monthly_dates","monthly_prices","quarter_idx","findIndex","performance_obj","displayed","index","display_value","index_value","percentage","displayed_performance","qdata","end_tickervaluefraction","end_cashfraction","StatusMessages","all_status_messages","message","content","WhatIf","balanceable_value","balance_target_set","balance_target_column","sell_all_of","cash_treatment","cash_remaining","cash_valid","isDisabled","new_balanceable_value","get_balanceable_value","stored_balance_target_set","localStorage","getItem","stored_balance_target_column","stored_cash_treatment","stored_cash_remaining","selectedOptions","user_whole_dollars_string","user_whole_dollars","valid_whole_dollars_string","setItem","multiple_tickers","item","user_remaining_cash","remaining_cash","on_whatif_submit","show_holdings","show_untagged","show_tagged","excludable_tickers","all_positions","untagged","entry","multiple","htmlFor","selected","defaultChecked","show_cash","InputForms","which_inputs","onWhichInputs","stored_which_inputs","new_which_inputs","Fragment","all_current_quotes","passthrough_strings","default_shown_columns","ComparingStocks","allIndiciesTickers","allIndiciesAliases","allStocks","allCurrentQuotes","allMonthlyQuotes","allPositions","allTransactions","allTags","allPerformanceNumbers","allRisk","allWhatifs","last_error_messages","aggrPerformance","aggrBasis","aggrRealized","aggrTotalValue","show_index","show_aggregates","sort_dir_asc","shown_columns","done","tickerIsIndex","convertNameForIndicies","getTransactionById","getTransactionsByTicker","getPositionFromSingleTickerTransactions","getPositionFromCashTransactions","calculateAggrPositionInfo","calculateAggrPerformance","populateSymbolCount","onInputChange","onShowInputChange","onChangeWhatifFormat","onChangeSort","showColumns","createMessage","onToggleShowColumn","onNewTransaction","onImportTransactions","onNewCash","onNewTags","onNewTickers","onRemoveFromTag","onDeleteTicker","onDeleteTag","onDeleteTransaction","onEditCell","onModifyRiskFactor","onEscapeKey","onNewMessages","getCurrentValue","getCurrentShares","getBasis","getBalanceableValue","onWhatifSubmit","onWhatifGo","getIndicies","getHoldings","getAdded","getTagged","getUntagged","nameIsAnAggregate","nameIsSpecial","sortTickers","stored_sort_column","stored_sort_dir_asc","stored_whatif_format","stored_allTags","stored_allTransactions","stored_allRisk","stored_controls","control","stored_control","init_shown_columns","stored_shown_columns","stored_baseline","short_pct_gain","medium_pct_gain","long_pct_gain","indexed_risk_data","raw_current_quote_data","require","sample_current_quotes","indexed_current_quote_data","raw_quote","adjusted_ticker","raw_monthly_quote_data","sample_monthly_quotes","indexed_monthly_quote_data","index_performance","quoteTimeSeriesDesc","prev_short","prev_medium","prev_long","newPositions","newCurrentQuotes","newMonthlyQuotes","newPerformanceNumbers","newRisk","cash_delta_from_stock_transactions","newPosition","newCurrentQuote","quoteResult","slice","newMonthlyQuote","newPerformance","ticker_now","ticker_perf_short","ticker_perf_medium","ticker_perf_long","change","cash_transactions","aggr_position_info","aggr_performance","transaction_id","inflows","outflows","position_start_date","substr","cash_transaction","cash_amount","all_quotes","holdings","cash","aggr_totalbasis_by_tag","aggr_totalrealized_by_tag","aggr_totalvalue_by_tag","position_info","ticker_basis","ticker_realized_gains","ticker_shares","ticker_price","all_performance_numbers","aggr_performance_by_tag","num_tickers","all_stocks_of_interest","values","array_of_tickers","short","medium","long","new_aggr_performance","tag_performance","time_range","new_baseline_name","new_baseline","checked","new_whatif_format","new_sort_column","prevState","column_names","new_shown_column_names","new_shown_columns","splice","idx","message_content","getTime","new_tags","newAllTags","new_tickers","untagged_ticker","delete_ticker","all_tags_for_this_ticker","newAllPositions","newAllTransactions","newAllStatusMessages","new_messages","newLastErrorMessages","message_obj","new_transaction_summary","new_transaction","orig_start_date","orig_basis","orig_current_shares","orig_realized_gains","new_start_date","new_current_shares","updatedPosition","updatedCashPosition","imported_tickers","imported_transactions","imported_risk","already_added","window","location","reload","new_cash_transaction_summary","new_cash_transaction","new_cash","delete_transaction_id","transaction_to_delete","remainingTransactionsForTicker","remove_from_tag","remove_ticker","all_other_tags_for_this_ticker","newUntagged","tickers_losing_a_tag","all_other_tagged_tickers","newAllRisk","factor","current_cash_position","show_whatif_columns","sell_all_set","adjusting_cash","original_cash_position","total_balance_value","ticker_set","new_whatif","actual_remaining_cash","risk_factors","whatif_currentshares","whatif_balancedvalue","value_delta","original_currentvalue","original_basis","whatif_basis","target_delta_shares","target_delta","ceil","whatif_balancedbasis","original_currentshares","losing","numerator_product","numerator","denominator_terms","fill","ticker_idx","term","term_idx","denominator","reduce","accumulator","currentValue","targets","holding","added_tickers","grid_rows","names_list","quote_columns","holdings_columns","performance_columns","sorted_names_list","value_a","value_b","positionvalue_a","positionvalue_b","basis_a","basis_b","tickers_to_show","unique_tickers_to_show","sorted_tickers","row_data","tag_membership","tag_info","sorted_aggr_tickers","aggr_row_data","aggr_ticker","new_aggr_data","shown_column_names","all_columns_namesorted","row_popover","Popover","Title","as","Content","column_popover","PopulateHeaderRow","symbol_count","PopulateRow","all_row_data","new_row","status_message","OverlayTrigger","trigger","placement","overlay","variant","cellSpacing","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.b00cf442.chunk.js","sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\n\n\n// This component displays table headers for either tickers (is_aggregate === 0) or tags (is_aggregate === 1).\nexport class GridHeaderRow extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.onHeaderCellClick = this.onHeaderCellClick.bind(this)\n        this.styleCell = this.styleCell.bind(this)\n    }\n\n    styleCell(column_index, column_name) {\n        let classes = ''\n        if (column_index !== 0) {\n            classes += 'clickable '\n        }\n        if (column_name.startsWith('whatif_')) {\n            classes += 'whatif '\n        }\n        return classes\n    }\n\n    onHeaderCellClick(column_name) {\n        if (column_name.startsWith('whatif_')) {\n            this.props.on_change_whatif_format()\n        } else {\n            this.props.on_change_sort(column_name)\n        }\n    }\n\n    render() {\n\n        let is_aggregate = this.props.is_aggregate\n        let sort_column = this.props.sort_column\n        let sort_triangle = this.props.sort_triangle\n        let symbol_count_str = this.props.symbol_count_str\n\n        let all_columns = []\n\n        let first_column = { // always the tag or ticker membership column\n            name: 'first'\n        }\n        if (this.props.is_aggregate) {\n            first_column['display_name'] = 'Tickers'\n        } else {\n            first_column['display_name'] = 'Tags'\n        }\n        all_columns.push(first_column)\n\n        let self = this\n        this.props.columns.forEach(function(column) {\n            let new_column = {}\n            new_column['name'] = column.name\n            if (column.name === 'symbol') {\n                if (is_aggregate) {\n                    new_column['display_name'] = 'Tags'\n                } else {\n                    new_column['display_name'] = 'Tickers'\n                }\n            } else if (column.name.startsWith('whatif_')) {\n                if (self.props.whatif_format === 'deltas') {\n                    new_column['display_name'] = column.display_name.replace('What-If', 'What-If DELTA')\n                } else {\n                    new_column['display_name'] = column.display_name.replace('What-If', 'What-If NEW')\n                }\n            } else {\n                new_column['display_name'] = column.display_name\n            }\n            all_columns.push(new_column)\n        })\n\n        return (\n            <tr>\n            {this.props.highlight_column !== null && all_columns.map( (column,i) => (\n                <th\n                key={ column.name }\n                >\n                    { (column.name === this.props.highlight_column) \n                    ? 'BEFORE BALANCING' \n                    : (column.name === 'whatif_' + this.props.highlight_column) \n                        ? 'AFTER BALANCING' \n                        : String.fromCharCode(160) }\n                </th>\n            ))}\n            {this.props.highlight_column === null && all_columns.map( (column,i) => (\n                <th \n                    key={ column.name } \n                    className={ self.styleCell(i, column.name) }\n                    onClick={ (i!==0) ? (e)=>this.onHeaderCellClick(column.name) : undefined }\n                >   { (i===1 && !is_aggregate) ? column.display_name + symbol_count_str : column.display_name }\n                    { column.name === sort_column ? sort_triangle : '' }\n                </th>\n            ))}\n            </tr>\n        )\n    }\n\n}\n\nGridHeaderRow.propTypes = {\n    highlight_column: PropTypes.string,\n    is_aggregate: PropTypes.bool,\n    columns: PropTypes.array,\n    symbol_count_str: PropTypes.string,\n    sort_column: PropTypes.string,\n    sort_triangle: PropTypes.string,\n    whatif_format: PropTypes.string,\n    on_change_sort: PropTypes.func,\n    on_change_whatif_format: PropTypes.func\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class EditNumericCell extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            user_value: '',\n            user_value_is_valid: false\n        }\n        this.handleEscapeKey = this.handleEscapeKey.bind(this)\n        this.handleChange = this.handleChange.bind(this)\n        this.handleSubmit = this.handleSubmit.bind(this)\n    }\n\n    componentDidMount() {\n        if (isNaN(this.props.original_value)) {\n            this.setState({ user_value: '' }) \n        } else {\n            this.setState({ user_value: this.props.original_value })\n        }\n        this.elem.focus()\n        document.addEventListener('keydown', this.handleEscapeKey, false)\n    }\n\n    componentWillUnmount() {\n        document.removeEventListener('keydown', this.handleEscapeKey, false)\n    }\n\n    handleEscapeKey(event) {\n        if (event.keyCode === 27) {\n            this.props.on_escape_key()\n        }\n    }\n\n    handleChange(event) {\n\n        let {name, value } = event.target\n\n        // when the input changes, validate the user's value\n        if (name === 'user_value') {\n            if (value.length && !isNaN(value) && value > 0) {\n                this.setState({ user_value: value, user_value_is_valid: true })\n            } else {\n                this.setState({ user_value: value, user_value_is_valid: false })\n            }\n        }\n    }\n\n    handleSubmit(event) {\n        event.preventDefault()\n        this.props.on_new_value(this.state.user_value)\n    }\n\n    render() {\n        return (\n            <form onSubmit={this.handleSubmit}>\n                <input ref={(elem) => {this.elem = elem}} type=\"text\" id=\"edit-cell\" name=\"user_value\" value={this.state.user_value} onChange={this.handleChange} size=\"5\" />\n                <button type=\"submit\" disabled={!this.state.user_value_is_valid}>S</button>\n            </form>\n        )\n    }\n}\n\nEditNumericCell.propTypes = {\n    original_value: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    on_new_value: PropTypes.func.isRequired,\n    on_escape_key: PropTypes.func.isRequired\n}\n\n\n\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { EditNumericCell } from './EditNumericCell'\n\n\n// This component displays table data for either tickers (is_aggregate === 0) or tags (is_aggregate === 1).\n// For tickers, the membership_set prop is all of the tags that it belongs to.\n// For tags, the membership_set prop is all of the tags that belong to it.\nexport class GridRow extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            hovering_symbol: false,\n            hovering_risk_factor: false,\n            user_risk_factor: '',\n            user_risk_factor_valid: false\n        }\n        this.formatDate = this.formatDate.bind(this)\n        this.onWhatifCellClick = this.onWhatifCellClick.bind(this)\n        this.toggleHoverSymbol = this.toggleHoverSymbol.bind(this)\n        this.toggleHoverRiskFactor = this.toggleHoverRiskFactor.bind(this)\n        this.populateMemberButton = this.populateMemberButton.bind(this)\n        this.populateDeleteButton = this.populateDeleteButton.bind(this)\n        this.populateEditButton = this.populateEditButton.bind(this)\n        this.editRiskFactor = this.editRiskFactor.bind(this)\n        this.onNewValue = this.onNewValue.bind(this)\n        this.populateCellValue = this.populateCellValue.bind(this)\n        this.styleCell = this.styleCell.bind(this)\n        this.numberWithCommas = this.numberWithCommas.bind(this)\n        this.daysAgo = this.daysAgo.bind(this)\n    }\n\n    formatDate(epoch) {\n        var d = new Date(epoch),\n            month = '' + (d.getMonth() + 1),\n            day = '' + d.getDate(),\n            year = d.getFullYear();\n    \n        if (month.length < 2) \n            month = '0' + month;\n        if (day.length < 2) \n            day = '0' + day;\n    \n        return [year, month, day].join('-');\n    }\n\n    onWhatifCellClick() {\n        this.props.on_change_whatif_format()\n    }\n\n    toggleHoverSymbol() {\n        this.setState({ hovering_symbol: !this.state.hovering_symbol })\n    }\n\n    toggleHoverRiskFactor() {\n        this.setState({ hovering_risk_factor: !this.state.hovering_risk_factor })\n    }\n\n    // this button removes a ticker from a tag\n    populateMemberButton(symbol) {\n        let is_aggr = this.props.is_aggregate\n        let row_name = this.props.row_name\n        if (is_aggr) {\n            // row_name is a TAG\n            // symbol is a TICKER \n            if (row_name !== 'untagged') {\n                return (\n                    <button key={row_name + symbol + is_aggr} className=\"tag-removal\" onClick={ (e) => { this.props.on_remove_from_tag(row_name, symbol)} }>{ symbol }</button>\n                )\n            } else {\n                return (\n                    <button key={row_name + symbol + is_aggr} className=\"tag-removal\" disabled={true}>{ symbol }</button>\n                )\n            }\n        } else {\n            // row_name is a TICKER\n            // symbol is a TAG \n            if (!this.props.special_classes.includes('index') && !this.props.special_classes.includes('cash') && !this.props.membership_set.includes('untagged')) {\n                return (\n                    <button key={row_name + symbol + is_aggr} className=\"tag-removal\" onClick={ (e) => { this.props.on_remove_from_tag(symbol, row_name)} }>{ symbol }</button>\n                )\n            } else {\n                return (\n                    '-'\n                )\n            }\n        }\n    }\n\n    // this button deletes the ticker or tag completely\n    populateDeleteButton(column_name, is_aggregate) {\n        let classes = 'delete'\n        if (this.state.hovering_symbol) {\n            classes += ' hovering'\n        }\n        if (is_aggregate) {\n            if (column_name === 'symbol' && this.props.row_name !== 'untagged') {\n                return (\n                    <button className={classes} onClick={ (e) => {this.props.on_delete_tag(this.props.row_name)}}>x</button>\n                )\n            } else {\n                return\n            }\n        } else {\n            if (column_name === 'symbol' \n                && !this.props.special_classes.includes('index')\n                && !(this.props.row_name === 'cash' && isNaN(this.props.current_shares)) ) {\n                return (\n                    <button className={classes} onClick={ (e) => {this.props.on_delete_ticker(this.props.row_name)}}>x</button>\n                )\n            } else {\n                return\n            }\n        }\n    }\n\n    // the edit button is an extra affordance; clicking anywhere in the cell enters edit mode on this cell's value\n    populateEditButton(column_name, row_name) {\n        let classes = 'edit'\n        if (this.state.hovering_risk_factor) {\n            classes += ' hovering'\n        }\n        if ( column_name === 'risk_factor'\n            && row_name !== this.props.editing_row\n            && row_name !== 'cash'\n            && !this.props.is_aggregate \n            && !this.props.special_classes.includes('index') ) {\n                return (\n                    <button className={classes}>{String.fromCharCode(0x270e)}</button>\n                )\n        } else {\n            return\n        }\n    }\n\n    editRiskFactor(row_name) {\n        this.props.on_edit_cell(row_name)\n    }\n\n    styleCell(column_name) {\n        let classes = 'position-cell'\n        const row_name = this.props.row_name\n        const change_pct = this.props.change_pct\n        const current_shares = this.props.current_shares\n        const special_classes = this.props.special_classes\n        const performance = this.props.performance_numbers\n        const baseline = this.props.baseline\n\n        // hovering\n        if ( this.state.hovering_symbol\n            && column_name === 'symbol' \n            && !special_classes.includes('index') \n            && row_name !== 'untagged'\n            && !(row_name === 'cash' && isNaN(current_shares)) ) {\n            classes += ' hovering'\n        }\n        if ( this.state.hovering_risk_factor\n            && column_name === 'risk_factor' \n            && !special_classes.includes('index') \n            && !this.props.is_aggregate\n            && row_name !== 'cash' ) {\n            classes += ' hovering'\n        }\n\n        // whatif\n        if ( column_name.startsWith('whatif_') ) {\n            classes += ' clickable whatif'\n        }\n\n        // italics\n        if ( column_name === 'symbol' && row_name === 'untagged') {\n            classes += ' italics'\n        }\n\n        switch (column_name) {\n            case 'symbol':\n                classes += ' col-symbol'\n                break\n            case 'risk_factor':\n                classes += ' col-riskfactor'\n                break\n            case 'change_pct':\n                if (change_pct > 0) {\n                    classes += ' text-green'\n                } else if (change_pct < 0) {\n                    classes += ' text-red'\n                }\n                break\n            case 'short_change_pct':\n                if (performance.short_change_pct > 0 && performance.short_change_pct > baseline.short_change_pct) {\n                    classes += ' text-green'\n                } else if (performance.short_change_pct < 0 && performance.short_change_pct < baseline.short_change_pct) {\n                    classes += ' text-red'\n                }\n                if (this.props.style_realized_performance\n                    && row_name !== 'cash' \n                    && !special_classes.includes('index')) {\n                        if (isNaN(current_shares) \n                            || !current_shares \n                            || this.daysAgo(this.props.start_date) < 180\n                            ){\n                            classes += (this.props.show_only_achieved_performance) ? ' hide' : ' strikethrough'\n                        } else {\n                            classes += ' strong'\n                        }\n                }\n                break\n            case 'medium_change_pct':\n                if (performance.medium_change_pct > 0 && performance.medium_change_pct > baseline.medium_change_pct) {\n                    classes += ' text-green'\n                } else if (performance.medium_change_pct < 0 && performance.medium_change_pct < baseline.medium_change_pct) {\n                    classes += ' text-red'\n                }\n                if (this.props.style_realized_performance\n                    && row_name !== 'cash' \n                    && !special_classes.includes('index')) {\n                        if (isNaN(current_shares) \n                            || !current_shares \n                            || this.daysAgo(this.props.start_date) < 365\n                            ){\n                            classes += (this.props.show_only_achieved_performance) ? ' hide' :  ' strikethrough'\n                        } else {\n                            classes += ' strong'\n                        }\n                }\n                break\n            case 'long_change_pct':\n                if (performance.long_change_pct > 0 && performance.long_change_pct > baseline.long_change_pct) {\n                    classes += ' text-green'\n                } else if (performance.long_change_pct < 0 && performance.long_change_pct < baseline.long_change_pct) {\n                    classes += ' text-red'\n                }\n                if (this.props.style_realized_performance\n                    && row_name !== 'cash' \n                    && !special_classes.includes('index')) {\n                        if (isNaN(current_shares) \n                            || !current_shares \n                            || this.daysAgo(this.props.start_date) < 730\n                            ){\n                            classes += (this.props.show_only_achieved_performance) ? ' hide' : ' strikethrough'\n                        } else {\n                            classes += ' strong'\n                        }\n                }\n                break\n            default:\n                break\n        }\n        return classes\n    }\n\n    onNewValue(new_value) {\n        this.props.on_modify_risk_factor(this.props.row_name, new_value)\n    }\n\n    // prints the value that is (usually) explicitly passed in via props\n    // AND is responsible for calculating \"percent_value\", \"percent_basis\", and \"percent_profit\"\n    populateCellValue(column) {\n\n        if ( column.name === 'risk_factor'\n            && this.props.row_name === this.props.editing_row ) {\n            return (\n                <EditNumericCell \n                    original_value={this.props.current_edit_value} \n                    on_new_value={this.onNewValue} \n                    on_escape_key={this.props.on_escape_key}\n                />\n            )\n        }\n\n        let prefix = ''\n        let suffix = ''\n        let adjust_decimal = false\n        let num_decimals\n        let value, baseline_value\n        let performance_value = false\n\n        const total_value = this.props.total_value\n        const total_basis = this.props.total_basis\n        const current_price = this.props.current_price\n        let current_shares = this.props.current_shares\n        const current_value = this.props.current_value\n        let risk_factor = (this.props.risk_factor !== null) ? this.props.risk_factor : 0.20\n        let visible_risk_factor = (this.props.risk_factor !== null) ? this.props.risk_factor : 'n/a'\n        if (this.props.row_name === 'cash') {\n            risk_factor = 0\n            visible_risk_factor = 0\n        }\n        let value_at_risk = current_value * risk_factor\n        let basis = this.props.basis\n        let basis_risked = basis * risk_factor\n        let realized_gains = this.props.realized_gains\n        const whatif = this.props.whatif\n\n        let percent_value, percent_basis, percent_profit\n\n        // calculate percent_value\n        if (isNaN(current_value)) {\n            percent_value = 'n/a'\n        } else {\n            if (isNaN(total_value) || total_value === 0) {\n                percent_value = 'n/a'\n            } else {\n                percent_value = (current_value !== 'n/a') ? current_value / total_value * 100 : 'n/a'\n            }\n        }\n\n        // calculate percent_basis\n        if (isNaN(current_value)) {\n            percent_basis = 'n/a'\n        } else {\n            if (isNaN(total_basis) || total_basis === 0) {\n                percent_basis = 'n/a'\n            } else {\n                percent_basis = (current_value !== 'n/a') ? basis / total_basis * 100 : 'n/a'\n            }\n        }\n\n        // calculate percent_profit\n        if (isNaN(current_value) || isNaN(basis)) {\n            percent_profit = 'n/a'\n        } else {\n            if (current_shares === 0) {\n                percent_profit = 'n/a'\n            } else if (basis > current_value) {\n                percent_profit = 'losing'\n            } else if (basis < current_value) {\n                percent_profit = (1 - basis / current_value) * 100\n            } else {\n                percent_profit = 0\n            }\n        }\n\n        switch (column.type) {\n            case 'number':\n                adjust_decimal = true\n                num_decimals = column.num_decimals\n                break\n            case 'currency':\n                adjust_decimal = true\n                num_decimals = column.num_decimals\n                prefix = '$'\n                break\n            case 'percentage':\n                adjust_decimal = true\n                num_decimals = column.num_decimals\n                suffix = '%'\n                break\n            default:\n                break\n        }\n\n        switch (column.name) {\n            case 'symbol':\n                value = this.props.row_name\n                break\n            case 'start_date':\n                value = this.props.start_date\n                break\n            case 'current_shares':\n                value = current_shares\n                break\n            case 'whatif_current_shares':\n                if (whatif === null) {\n                    value = 'n/a'\n                } else if (this.props.whatif_format === 'deltas') {\n                    value = whatif.current_shares - ((current_shares === 'n/a') ? 0 : current_shares)\n                } else {\n                    value = whatif.current_shares\n                }\n                break\n            case 'current_price':\n                value = current_price\n                break\n            case 'quote_date':\n                value = this.props.quote_date\n                break\n            case 'current_value':\n                value = current_value\n                break\n            case 'whatif_current_value':\n                if (whatif === null) {\n                    value = 'n/a'\n                } else if (this.props.whatif_format === 'deltas') {\n                    value = whatif.current_value - ((current_value === 'n/a') ? 0 : current_value)\n                } else {\n                    value = whatif.current_value\n                }\n                break\n            case 'percent_value':\n                value = percent_value\n                break\n            case 'basis':\n                value = basis\n                break\n            case 'whatif_basis':\n                if (whatif === null) {\n                    value = 'n/a'\n                } else if (this.props.whatif_format === 'deltas') {\n                    value = whatif.basis - ((basis === 'n/a') ? 0 : basis)\n                } else {\n                    value = whatif.basis\n                }\n                break\n            case 'basis_risked':\n                value = basis_risked\n                break\n            case 'whatif_basis_risked':\n                if (whatif === null) {\n                    value = 'n/a'\n                } else if (this.props.whatif_format === 'deltas') {\n                    value = whatif.basis_risked - ((basis_risked === 'n/a') ? 0 : basis_risked)\n                } else {\n                    value = whatif.basis_risked\n                }\n                break\n            case 'percent_basis':\n                value = percent_basis\n                break\n            case 'percent_profit':\n                value = percent_profit\n                break\n            case 'realized_gains':\n                value = realized_gains\n                break\n            case 'change_pct':\n                value = this.props.change_pct\n                break\n            case 'risk_factor':\n                value = visible_risk_factor\n                break\n            case 'risk_factor_modified':\n                if (this.props.risk_factor_modified !== null) {\n                    value = this.formatDate(parseInt(this.props.risk_factor_modified))\n                } else {\n                    value = 'n/a'\n                }\n                break\n            case 'value_at_risk':\n                value = value_at_risk\n                break\n            case 'whatif_value_at_risk':\n                if (whatif === null) {\n                    value = 'n/a'\n                } else if (this.props.whatif_format === 'deltas') {\n                    value = whatif.value_at_risk - ((value_at_risk === 'n/a') ? 0 : value_at_risk)\n                } else {\n                    value = whatif.value_at_risk\n                }\n                break\n            case 'volume':\n                value = this.props.volume\n                break\n            case 'dollar_volume':\n                value = this.props.current_price * this.props.volume\n                break\n            case 'short_change_pct':\n                value = this.props.performance_numbers.short_change_pct\n                performance_value = true\n                baseline_value = this.props.baseline.short_change_pct\n                break\n            case 'medium_change_pct':\n                value = this.props.performance_numbers.medium_change_pct\n                performance_value = true\n                baseline_value = this.props.baseline.medium_change_pct\n                break\n            case 'long_change_pct':\n                value = this.props.performance_numbers.long_change_pct\n                performance_value = true\n                baseline_value = this.props.baseline.long_change_pct\n                break\n            default:\n                break\n        }\n        if ( this.props.row_name === 'cash' || (this.props.is_aggregate && !this.props.membership_set.length) ) {\n            switch (column.name) {\n                case 'realized_gains': \n                case 'percent_profit': \n                case 'volume': \n                case 'dollar_volume': \n                case 'short_change_pct': \n                case 'medium_change_pct': \n                case 'long_change_pct': \n                    value = 'n/a'\n                    break\n                default:\n                    break\n            }\n        }\n\n        if (value === null || value === 'n/a') {\n            return '-'\n        } else if (column.type === 'string') {\n            return value\n        } else if (!isNaN(value)) {\n            if (adjust_decimal) {\n                if (column.hasOwnProperty('scaling_power')) {\n                    value *= Math.pow(10, column.scaling_power)\n                }\n                if (performance_value && this.props.baseline.name !== 'zero_pct_gain') {\n                    value = value - baseline_value\n                }\n                if (value.toString().indexOf('.')) {\n                    value = (Math.round(Math.pow(10, num_decimals) * value) / Math.pow(10, num_decimals)).toFixed(num_decimals)\n                }\n            }\n            if (value >= 0) {\n                prefix = (column.name.startsWith('whatif_') && this.props.whatif_format === 'deltas') ? '+' + prefix : prefix\n                return value = prefix + this.numberWithCommas(value) + suffix\n            } else {\n                return value = '-' + prefix + this.numberWithCommas(Math.abs(value)) + suffix\n            }\n        } else if (column.hasOwnProperty('passthrough_strings') && column['passthrough_strings']) {\n            return value\n        } else if (column.type === 'number' || column.type === 'percentage' || column.type === 'currency') {\n            return '-'\n        } else {\n            return '??'\n        }\n    }\n\n    numberWithCommas(x) {\n        return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n    }\n\n    daysAgo(date_str) { // yyyy-mm-dd\n        let now = new Date()\n        let then = new Date(date_str)\n        let diff = Math.round((now - then) / 1000 / 60 / 60 / 24)\n        if (date_str === 'n/a') {\n            return -1\n        } else {\n            return diff\n        }\n    }\n\n    render() {\n        const is_aggr = this.props.is_aggregate\n\n        let row_classes = 'position-row' \n        this.props.special_classes.forEach(function(special_class) {\n            if (special_class === 'index') {\n                row_classes += ' position-is-index'\n            }\n            if (special_class === 'cash') {\n                row_classes += ' position-is-cash'\n            }\n            if (special_class === 'aggregate') {\n                row_classes += ' position-is-aggregate'\n            }\n        })\n\n        let member_count = this.props.membership_set.length\n\n        let self = this\n        return (\n            <tr className={ row_classes }>\n                <td>\n                    { member_count ? this.props.membership_set.sort().map(symbol => this.populateMemberButton(symbol)) : (this.props.special_classes.length ? '' : '-') }\n                </td>\n                { this.props.columns.map(function(column) {\n                    if (column.name === 'symbol') {\n                        return (\n                            <td key={column.name} className={ self.styleCell(column.name) } onMouseEnter={self.toggleHoverSymbol} onMouseLeave={self.toggleHoverSymbol}>{ self.populateCellValue(column) }{ is_aggr && member_count ? '('+member_count+')' : '' }{ self.populateDeleteButton(column.name, is_aggr) }</td>\n                        )\n                    } else if (column.name === 'risk_factor') {\n                        return (\n                            <td key={column.name} className={ self.styleCell(column.name) } onClick={ (e)=>self.editRiskFactor(self.props.row_name) } onMouseEnter={self.toggleHoverRiskFactor} onMouseLeave={self.toggleHoverRiskFactor}>{ self.populateCellValue(column) }{ self.populateEditButton(column.name, self.props.row_name) }</td>\n                        )\n                    } else if (column.name.startsWith('whatif_')) {\n                        return (\n                            <td key={column.name} className={ self.styleCell(column.name) } onClick={ (column.name.startsWith('whatif_')) ? (e)=>self.onWhatifCellClick() : undefined }>{ self.populateCellValue(column) }{ self.populateDeleteButton(column.name, is_aggr) }</td>\n                        )\n                    } else {\n                        return (\n                            <td key={column.name} className={ self.styleCell(column.name) }>{ self.populateCellValue(column) }{ self.populateDeleteButton(column.name, is_aggr) }</td>\n                        )\n                    }\n                })}\n            </tr>\n        )\n    }\n\n}\n\nGridRow.defaultProps = {\n    performance_numbers: {\n        short_change_pct: 0,\n        medium_change_pct: 0,\n        long_change_pct: 0\n    }\n}\n\nGridRow.propTypes = {\n    is_aggregate: PropTypes.bool,\n    columns: PropTypes.array,\n    row_name: PropTypes.string,\n    membership_set: PropTypes.array,\n    special_classes: PropTypes.array,\n    start_date: PropTypes.string,\n    current_shares: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    current_price: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    current_value: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    change_pct: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    quote_date: PropTypes.string,\n    volume: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    basis: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    realized_gains: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    risk_factor: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    risk_factor_modified: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    performance_numbers: PropTypes.object,\n    show_only_achieved_performance: PropTypes.bool,\n    baseline: PropTypes.object,\n    style_realized_performance: PropTypes.bool,\n    total_value: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    total_basis: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    whatif: PropTypes.object,\n    whatif_format: PropTypes.string,\n    on_change_whatif_format: PropTypes.func,\n    on_remove_from_tag: PropTypes.func,\n    on_delete_ticker: PropTypes.func,\n    on_delete_tag: PropTypes.func,\n    editing_row: PropTypes.string,\n    current_edit_value: PropTypes.oneOfType([\n        PropTypes.number,\n        PropTypes.string\n      ]),\n    on_edit_cell: PropTypes.func,\n    on_modify_risk_factor: PropTypes.func,\n    on_escape_key: PropTypes.func,\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class GridRowTotals extends React.Component {\n\n    render() {\n\n        const total_value = this.props.total_value\n        const total_basis = this.props.total_basis\n        const total_performance = this.props.total_performance\n\n        function numberWithCommas(x) {\n            return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n        }\n\n        function populateTotalsCellValue(column) {\n            let value\n            switch (column.name) {\n                case 'current_value':\n                    value = '$' + numberWithCommas(Math.round(total_value))\n                    break\n                case 'percent_value':\n                    value = (total_value) ? '100%' : 'n/a'\n                    break\n                case 'basis':\n                    value = '$' + numberWithCommas(Math.round(total_basis))\n                    break\n                case 'percent_basis':\n                    value = (total_basis) ? '100%' : 'n/a'\n                    break\n                case 'short_change_pct':\n                    value = (Math.round(10 * total_performance.short_change_pct) / 10).toFixed(1) + '%'\n                    break\n                case 'medium_change_pct':\n                    value = (Math.round(10 * total_performance.medium_change_pct) / 10).toFixed(1) + '%'\n                    break\n                case 'long_change_pct':\n                    value = (Math.round(10 * total_performance.long_change_pct) / 10).toFixed(1) + '%'\n                    break\n                default:\n                    break\n            }\n            if (value === null || value === 'n/a') {\n                return '-'\n            } else {\n                return value\n            }\n        }\n\n        function styleTotalsCell(column) {\n            let classes = ''\n            switch (column) {\n                case 'current_value':\n                case 'percent_value':\n                case 'basis':\n                case 'percent_basis':\n                case 'short_change_pct':\n                case 'medium_change_pct':\n                case 'long_change_pct':\n                    classes += 'totals'\n                    break\n                default:\n                    classes = ''\n                    break\n            }\n            return classes\n        }\n\n        return (\n            <tr>\n                <td></td>\n                { this.props.columns.map(column => (\n                <td key={column.name} className={ styleTotalsCell(column.name) }>{ populateTotalsCellValue(column) }</td>\n                ))}\n            </tr>\n        )\n    }\n\n}\n\nGridRowTotals.propTypes = {\n    columns: PropTypes.array,\n    total_value: PropTypes.number,\n    total_basis: PropTypes.number,\n    total_performance: PropTypes.object,\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class AddTicker extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            user_tickers_string: '',\n            add_to_tag: 'untagged',\n        }\n        this.handleTickersChange = this.handleTickersChange.bind(this)\n        this.handleTagChange = this.handleTagChange.bind(this)\n        this.handleReset = this.handleReset.bind(this)\n        this.handleSubmit = this.handleSubmit.bind(this)\n        this.validateTickers = this.validateTickers.bind(this)\n    }\n\n    handleTickersChange(event) {\n        this.setState({ user_tickers_string: event.target.value })\n    }\n\n    handleTagChange(event) {\n        this.setState({ add_to_tag: event.target.value })\n    }\n\n    handleReset(event) {\n        this.setState({ user_tickers_string: \"\" })\n    }\n\n    handleSubmit(event) {\n        event.preventDefault()\n        let user_tag = this.state.add_to_tag\n        let user_tickers = String(this.state.user_tickers_string)\n            .split(\" \")\n            .map(str => str.trim())\n            .map(str => str.toUpperCase())\n            .map(str => str.replace(/[^A-Z]/g, \"\"))\n        this.validateTickers(user_tag, Array.from(new Set(user_tickers)))\n    }\n\n    validateTickers(tag, tickers) {\n        let tickers_to_add = []\n        let new_status_messages = []\n        let self = this\n        const create_message = this.props.create_message\n        tickers.forEach(function(ticker) {\n            // ticker does not exist\n            if (!self.props.all_stocks.includes(ticker)) {\n                new_status_messages.push(create_message('ERROR: Ticker ' + ticker + ' does not exist.'))\n\n            // ticker is already in the target tag\n            } else if (self.props.all_tags[tag].includes(ticker)) {\n                if (tag === 'untagged') {\n                    new_status_messages.push(create_message('ERROR: Ticker ' + ticker + ' has already been added.'))\n                } else {\n                    new_status_messages.push(create_message('ERROR: Ticker ' + ticker + ' has already been added to tag \"'+ tag +'\".'))\n                }\n\n            // ticker is being added to a tag that it is not already in\n            } else {\n                let tagged_tickers = []\n                Object.keys(self.props.all_tags).forEach(function(tag) {\n                    if (tag !== 'untagged') {\n                        tagged_tickers = tagged_tickers.concat(self.props.all_tags[tag])\n                    }\n                })\n                if (tag === 'untagged' && tagged_tickers.includes(ticker)) {\n                    new_status_messages.push(create_message('ERROR: Ticker ' + ticker + ' has already been added to another named tag.'))\n                } else {\n                    if (tag === 'untagged') {\n                        new_status_messages.push(create_message('Ticker ' + ticker + ' has now been added.'))\n                    } else {\n                        new_status_messages.push(create_message('Ticker ' + ticker + ' has now been added to tag \"' + tag + '\".'))\n                    }\n                    tickers_to_add.push(ticker)\n                }\n            }\n        })\n        this.props.on_new_tickers(tag, tickers_to_add)\n        this.props.on_new_messages(new_status_messages)\n        this.handleReset()\n    }\n\n    render() {\n        return (\n            <section id=\"add-ticker\">\n                <form onSubmit={this.handleSubmit} onReset={this.handleReset}>\n                    <label>New Ticker(s):</label>\n                    <input value={this.state.user_tickers_string} onChange={this.handleTickersChange} placeholder=\"Dow30 tickers only\" required />\n                    <label>\n                        Add to Tag:\n                        <select value={this.state.add_to_tag} onChange={this.handleTagChange}>\n                            <option key=\"untagged\" value=\"untagged\">(no tag)</option>\n                            {Object.keys(this.props.all_tags).sort().filter(tag_name => tag_name !== 'untagged').map(tag_name => (\n                            <option key={tag_name} value={tag_name}>{tag_name}</option>\n                            ))}\n                        </select>\n                    </label>\n                    <section className=\"buttonrow\">\n                        <input className=\"btn btn-sm btn-primary\" type=\"submit\" value=\"Add Ticker(s)\" disabled={this.state.user_tickers_string===''}/>\n                    </section>\n                </form>\n            </section>\n        )\n    }\n}\n\nAddTicker.propTypes = {\n    all_stocks: PropTypes.array.isRequired,\n    all_tags: PropTypes.object.isRequired,\n    on_new_tickers: PropTypes.func.isRequired,\n    create_message: PropTypes.func.isRequired,\n    on_new_messages: PropTypes.func.isRequired\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class AddTag extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            user_tags_string: '',\n        }\n        this.handleChange = this.handleChange.bind(this)\n        this.handleReset = this.handleReset.bind(this)\n        this.handleSubmit = this.handleSubmit.bind(this)\n        this.validateTags = this.validateTags.bind(this)\n    }\n\n    handleChange(event) {\n        this.setState({ user_tags_string: event.target.value })\n    }\n\n    handleReset(event) {\n        this.setState({ user_tags_string: \"\" })\n    }\n\n    handleSubmit(event) {\n        event.preventDefault()\n        let user_tags = String(this.state.user_tags_string)\n            .split(\" \")\n            .map(str => str.trim())\n            .map(str => str.toLowerCase())\n            .map(str => str.replace(/[^a-z0-9:()-_!?]/g, \"\"))\n        this.validateTags(Array.from(new Set(user_tags)))\n    }\n\n    validateTags(tags) {\n        let tags_to_add = []\n        let new_status_messages = []\n        let self = this\n        tags.forEach(function(tag) {\n            if (self.props.all_tags.hasOwnProperty(tag)) {\n                new_status_messages.push(self.props.create_message('ERROR: Tag \"' + tag + '\" has already been created.'))\n            } else {\n                new_status_messages.push(self.props.create_message('Tag \"' + tag + '\" has now been created.'))\n                tags_to_add.push(tag)\n            }\n        })\n        this.props.on_new_tags(tags_to_add)\n        this.props.on_new_messages(new_status_messages)\n        this.handleReset()\n    }\n\n    render() {\n        return (\n            <section id=\"add-tag\">\n                <form onSubmit={this.handleSubmit} onReset={this.handleReset}>\n                    <label>New Tag Name(s):</label>\n                    <input value={this.state.user_tags_string} onChange={this.handleChange} required />\n                    <section className=\"buttonrow\">\n                        <input className=\"btn btn-sm btn-primary\" type=\"submit\" value=\"Create Tag(s)\" disabled={this.state.user_tags_string===''} />\n                    </section>\n                </form>\n            </section>\n        )\n    }\n}\n\nAddTag.propTypes = {\n    all_tags: PropTypes.object.isRequired,\n    on_new_tags: PropTypes.func.isRequired,\n    create_message: PropTypes.func.isRequired,\n    on_new_messages: PropTypes.func.isRequired\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class AddTransaction extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            transaction_date: '',\n            transaction: '',\n            user_cash_action: 'add',\n            user_cash_amount: '',\n        }\n        this.handleChange = this.handleChange.bind(this)\n        this.handleSubmit = this.handleSubmit.bind(this)\n        this.validateTransaction = this.validateTransaction.bind(this)\n        this.handleCashChange = this.handleCashChange.bind(this)\n        this.handleCashReset = this.handleCashReset.bind(this)\n        this.handleActionChange = this.handleActionChange.bind(this)\n        this.handleCashSubmit = this.handleCashSubmit.bind(this)\n    }\n\n    handleChange(event) {\n        const target = event.target\n        const new_value = target.value\n        const name = target.name\n        this.setState({ [name]: new_value })\n    }\n\n    handleActionChange(event) {\n        this.setState({ user_cash_action: event.target.value })\n    }\n\n    handleCashChange(event) {\n        this.setState({ user_cash_amount: event.target.value })\n    }\n\n    handleCashReset(event) {\n        this.setState({ user_cash_amount: \"\" })\n    }\n\n    handleCashSubmit(event) {\n        event.preventDefault()\n        let new_status_messages = []\n        let user_cash_action = this.state.user_cash_action\n        let user_date = this.state.transaction_date\n        let user_cash_amount = parseFloat(this.state.user_cash_amount.trim().replace(/\\$/g, \"\"))\n        if (isNaN(user_cash_amount)) {\n            new_status_messages.push(this.props.create_message('ERROR: Cash amount \"' + this.state.user_cash_amount + '\" is not in currency format.'))\n        } else {\n            let total = parseFloat((Math.round(user_cash_amount * 100) / 100).toFixed(2));\n            let valid_transaction_summary = user_date + ': ' + user_cash_action + ' $' + total.toFixed(2) + ' cash'\n            new_status_messages.push(this.props.create_message('Transaction \"' + valid_transaction_summary + '\" has now been recorded.'))\n            this.props.on_new_cash(valid_transaction_summary)\n            this.handleCashReset()\n        }\n        this.props.on_new_messages(new_status_messages)\n    }\n\n    handleSubmit(event) {\n        event.preventDefault()\n        let user_transaction = String(this.state.transaction)\n            .split(\" \")\n            .map(str => str.trim())\n            .map(str => str.replace(/[^A-Za-z0-9$.]/g, \"\"))\n        this.validateTransaction(user_transaction)\n    }\n\n    validateTransaction(transaction) {\n        let new_status_messages = []\n        const create_message = this.props.create_message\n\n        if (transaction.length < 4) {\n\n            new_status_messages.push(create_message('ERROR: Transaction \"' + transaction + '\" must be 4 terms.'))\n\n        } else {\n\n            let action = transaction[0].toLowerCase()\n            if (action !== 'buy' && action !== 'sell') {\n                new_status_messages.push(create_message('ERROR: Action \"' + transaction[0] + '\" must be either \"buy\" or \"sell\".'))\n            }\n\n            let num_shares = parseInt(transaction[1])\n            if (isNaN(num_shares) || num_shares < 1) {\n                new_status_messages.push(create_message('ERROR: Share count \"' + transaction[1] + '\" must be a positive integer.'))\n            }\n\n            let ticker = transaction[2].toUpperCase().replace(/[^A-Z]/g, \"\")\n            if (ticker !== transaction[2].toUpperCase() || !this.props.all_stocks.includes(ticker.toUpperCase())) {\n                new_status_messages.push(create_message('ERROR: Ticker \"' + transaction[2] + '\" does not exist.'))\n            }\n\n            let total = parseFloat(transaction[3].replace(/[^0-9.]/g, \"\"))\n            if (isNaN(total) || total < 0) {\n                new_status_messages.push(create_message('ERROR: Total amount \"' + transaction[3] + '\" must be a non-negative number.'))\n            } else {\n                total = parseFloat((Math.round(total * 100) / 100).toFixed(2));\n            }\n\n            // this transaction is valid\n            if (!new_status_messages.length) {\n\n                // also print the \"ticker has now been added\" message, if needed\n                let tagged_tickers = []\n                let self = this\n                Object.keys(this.props.all_tags).forEach(function(tag) {\n                    self.props.all_tags[tag].forEach(function(ticker) {\n                        if (!tagged_tickers.includes(ticker)) {\n                            tagged_tickers.push(ticker)\n                        }\n                    })\n                })\n                if (tagged_tickers.includes(transaction[2].toUpperCase())) {\n                    new_status_messages.push(create_message('Ticker ' + transaction[2].toUpperCase() + ' has now been added.'))\n                }\n\n                let valid_transaction_summary = this.state.transaction_date + ': ' + action + ' ' + num_shares + ' ' + ticker + ' $' + total.toFixed(2)\n                new_status_messages.push(create_message('Transaction \"' + valid_transaction_summary + '\" has now been recorded.'))\n                this.props.on_new_transaction(valid_transaction_summary)\n            }\n\n        }\n\n        // send all of the messages to print\n        this.props.on_new_messages(new_status_messages)\n    }\n\n    render() {\n        return (\n            <section id=\"add-transaction\">\n                <form>\n                    <label>Transaction Date:</label>\n                    <input name=\"transaction_date\" value={this.state.transaction_date} onChange={this.handleChange} type=\"date\" size=\"10\" />\n                </form>\n                <form onSubmit={this.handleSubmit}>\n                    <label>New Transaction:</label>\n\n                    <input name=\"transaction\" value={this.state.transaction} onChange={this.handleChange} size=\"25\" placeholder=\"buy 100 CSCO $2200.32\" required />\n\n                    <section className=\"buttonrow\">\n                        <input className=\"btn btn-sm btn-primary\" type=\"submit\" value=\"Add Transaction\" disabled={this.state.transaction==='' || this.state.transaction_date===''} />\n                    </section>\n                </form>\n                <form onSubmit={this.handleCashSubmit}>\n                    <label>Add/Remove Cash:\n                        <select value={this.state.action} onChange={this.handleActionChange}>\n                            <option value=\"dividend\">dividend</option>\n                            <option value=\"fee\">fee</option>\n                            <option value=\"transferIN\">transfer IN</option>\n                            <option value=\"transferOUT\">transfer OUT</option>\n                        </select>\n                        <input value={this.state.user_cash_amount} onChange={this.handleCashChange} size=\"12\" placeholder=\"$1000\" required />\n                    </label>\n                    <section className=\"buttonrow\">\n                        <input className=\"btn btn-sm btn-primary\" type=\"submit\" value=\"Adjust Cash\" disabled={this.state.user_cash_amount==='' || this.state.transaction_date===''}/>\n                    </section>\n                </form>\n            </section>\n        )\n    }\n}\n\nAddTransaction.propTypes = {\n    all_stocks: PropTypes.array.isRequired,\n    all_tags: PropTypes.object.isRequired,\n    on_new_transaction: PropTypes.func.isRequired,\n    on_new_cash: PropTypes.func.isRequired,\n    on_new_messages: PropTypes.func.isRequired\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class TransactionLog extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.exportRef = React.createRef()\n        this.importRef = React.createRef()\n        this.state = {\n            filter_str: '',\n            file: ''\n        }\n        this.handleChange = this.handleChange.bind(this)\n        this.onExportButton = this.onExportButton.bind(this)\n        this.onHiddenImportChange = this.onHiddenImportChange.bind(this)\n    }\n\n    handleChange(event) {\n        const target = event.target\n        const new_value = target.value\n        const name = target.name\n        this.setState({ [name]: new_value })\n    }\n        \n    onExportButton() {\n\n        // prepare the data\n        let exported_json = {\n            transactions: JSON.parse(JSON.stringify(this.props.all_transactions)),\n            risk: JSON.parse(JSON.stringify(this.props.all_risk))\n        }\n        var data = \"text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(exported_json));\n\n        // create the download link\n        var a = document.createElement('a')\n        a.href = 'data:' + data\n        a.download = 'transactions.json'\n        a.innerHTML = 'download'\n\n        // attach the download link, trigger it, and then remove it from the DOM\n        var container = this.exportRef.current\n        container.appendChild(a)\n        a.click()\n        a.remove()\n    }\n\n    onHiddenImportChange(files) {\n        if (files[0]) {\n            let self = this\n            let reader = new FileReader();\n            reader.readAsText(files[0], \"UTF-8\");\n            reader.onload = function (evt) {\n                let file_contents = JSON.parse(evt.target.result)\n                self.props.on_import_transactions(file_contents)\n            }\n        }\n    }\n\n    render() {\n        let sorted_filtered_transactions = this.props.all_transactions\n            .filter( transaction => transaction.summary.toLowerCase().includes(this.state.filter_str.toLowerCase()) )\n            .sort( function(a,b) {\n                if (a.summary < b.summary){\n                    return -1\n                } else if (a.summary > b.summary) {\n                    return 1\n                } else {\n                    return 0\n                }\n            })\n        return (\n            <section id=\"transaction-log\">\n                <section id=\"transaction-log-controls\">\n                    <form>\n                        <label>Filter:</label>\n                        <input name=\"filter_str\" value={this.state.filter_str} onChange={this.handleChange} size=\"15\" />\n\n                        <button className=\"btn btn-sm btn-primary\" onClick={this.onExportButton} disabled={!this.props.all_transactions.length}>export</button>\n                        <div ref={this.exportRef}></div>\n\n                        <label className=\"btn btn-sm btn-primary\">\n                        <input type=\"file\" ref={this.importRef} onChange={ (e) => this.onHiddenImportChange(e.target.files) } accept=\"application/json\" style={{width: 0, visibility: \"hidden\"}} />\n                        import\n                        </label>\n                    </form>\n                </section>\n                <section id=\"transactions\">\n                    {sorted_filtered_transactions.map( transaction => (\n                        <p key={transaction.modified_at} className=\"transaction\" onClick={ (e)=>this.props.on_delete_transaction(transaction.modified_at)}>{transaction.summary}</p>\n                    ))}\n                </section>\n            </section>\n        )\n    }\n}\n\nTransactionLog.propTypes = {\n    all_transactions: PropTypes.array.isRequired,\n    all_risk: PropTypes.object.isRequired,\n    on_delete_transaction: PropTypes.func.isRequired,\n    on_import_transactions: PropTypes.func.isRequired,\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class DeleteTag extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            delete_tag: 'untagged',\n        }\n        this.handleTagChange = this.handleTagChange.bind(this)\n        this.handleSubmit = this.handleSubmit.bind(this)\n    }\n\n    handleTagChange(event) {\n        this.setState({ delete_tag: event.target.value })\n    }\n\n    handleSubmit(event) {\n        event.preventDefault()\n\n        let user_tag = this.state.delete_tag\n        this.props.on_delete_tag(user_tag)\n\n        this.setState({ delete_tag: 'untagged' })\n    }\n\n    render() {\n        return (\n            <section id=\"delete-tag\">\n                <form onSubmit={this.handleSubmit}>\n                    <label>\n                        Delete Tag:\n                        <select value={this.state.delete_tag} onChange={this.handleTagChange}>\n                            <option key=\"untagged\" value=\"untagged\">(none)</option>\n                            {Object.keys(this.props.all_tags).sort().filter(tag_name => tag_name !== 'untagged').map(tag_name => (\n                            <option key={tag_name} value={tag_name}>{tag_name}</option>\n                            ))}\n                        </select>\n                    </label>\n                    <section className=\"buttonrow\">\n                        <input className=\"btn btn-sm btn-primary\" type=\"submit\" value=\"Delete Tag\" disabled={this.state.delete_tag==='untagged'} />\n                    </section>\n                </form>\n            </section>\n        )\n    }\n}\n\nDeleteTag.propTypes = {\n    all_tags: PropTypes.object.isRequired,\n    on_delete_tag: PropTypes.func.isRequired,\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class MyPerformance extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            quarter_data: [],\n            error_message: ''\n        }\n        this.generateQuarterData = this.generateQuarterData.bind(this)\n        this.numberWithCommas = this.numberWithCommas.bind(this)\n        this.formatCurrency = this.formatCurrency.bind(this)\n        this.getDisplayedPerformance = this.getDisplayedPerformance.bind(this)\n        this.getMonthEndQuote = this.getMonthEndQuote.bind(this)\n        this.getYear = this.getYear.bind(this)\n        this.getQuarter = this.getQuarter.bind(this)\n        this.getMonth = this.getMonth.bind(this)\n        this.styleCell = this.styleCell.bind(this)\n        this.formatPerformance = this.formatPerformance.bind(this)\n        this.formatWholePercentage = this.formatWholePercentage.bind(this)\n    }\n\n    componentDidMount() {\n        this.generateQuarterData()\n    }\n\n    generateQuarterData() {\n\n        let sorted_transactions = this.props.all_transactions.sort(function(a, b) {\n            if (a.date < b.date) {\n                return -1\n            } else if (a.date > b.date) {\n                return 1\n            } else {\n                return 0\n            }\n        })\n        \n        let quarter_data = []\n\n        if (sorted_transactions.length) {\n\n            let first_year = parseInt(sorted_transactions[0].date.split('-')[0])\n            let first_quarter = Math.floor((parseInt(sorted_transactions[0].date.split('-')[1])-1) / 3 + 1)\n\n            let today = new Date()\n            let today_year = today.getFullYear()\n            let today_month = today.getMonth() + 1\n            let today_quarter = Math.round(today.getMonth() / 3)\n\n            let quarters_of_performance = (today_year - first_year) * 4 + (today_quarter - first_quarter) + 1\n            let start_baselinequote, start_baselineprice\n            let prev_quote_month, prev_quote_year\n            if (first_quarter !== 1) {\n                prev_quote_year = first_year\n                prev_quote_month = (first_quarter - 1) * 3\n            } else {\n                prev_quote_year = first_year - 1\n                prev_quote_month = 9\n            }\n            start_baselinequote = this.getMonthEndQuote('S&P500', prev_quote_year, prev_quote_month)\n            if (start_baselinequote === null) {\n                let error_message = 'ERROR: quote for symbol S&P500 for month '+prev_quote_year+'-'+prev_quote_month+' is unavailable'\n                this.setState({ error_message: error_message })\n                console.log(error_message)\n                start_baselineprice = 'err.'\n            } else {\n                start_baselineprice = start_baselinequote.price\n            }\n\n            // calculate all quarter data\n            let year = first_year\n            let start_shares = {}, start_cash = 0, start_tickervalue = 0, start_totalvalue = 0\n            for (let q = 0; q < quarters_of_performance; q++) {\n                \n                // initialization\n                let new_quarter = {}\n                let quarter = (q + first_quarter - 1) % 4 + 1\n                new_quarter['quarter'] = quarter\n                if (quarter === 1 && q !== 0) {\n                    year += 1\n                }\n                new_quarter['year'] = year\n                let end_shares = {}, end_cash = 0, end_transfersinvalue = 0\n                if (q !== 0) {\n                    start_tickervalue = quarter_data[q-1].end_tickervalue\n                    start_totalvalue = quarter_data[q-1].end_totalvalue\n                    end_shares = Object.assign({}, quarter_data[q-1].end_shares)\n                    end_cash = quarter_data[q-1].end_cash\n                } else {\n                    end_shares = Object.assign({}, start_shares)\n                    end_cash = start_cash\n                }\n                new_quarter['name'] = (q !== quarters_of_performance - 1) ? year + 'Q' + quarter : 'current'\n\n                // determine quarter's transactions\n                let target_year = year\n                let quarter_transactions = sorted_transactions.filter( t => this.getYear(t.date) === target_year && this.getQuarter(t.date) === quarter )\n                new_quarter['transactions_of_stock'] = quarter_transactions.filter( t => t.ticker !== 'cash' )\n                new_quarter['transactions_of_cash'] = quarter_transactions.filter( t => t.ticker === 'cash' )\n\n                // determine quarter-end shares and cash value\n                for (let transaction of quarter_transactions) {\n                    let action, ticker, shares, total\n                    [action, ticker, shares, total] = [transaction.action, transaction.ticker, transaction.shares, transaction.total]\n                    if (ticker === 'cash') {\n                        let cash_delta = (action === 'transferIN' || action === 'dividend') ? total : -1 * total\n                        if (action === 'transferIN' || action === 'transferOUT') {\n                            end_transfersinvalue += cash_delta\n                        }\n                        end_cash += cash_delta\n                    } else {\n                        let share_delta = (action === 'buy') ? shares : -1 * shares\n                        let cash_delta = (action === 'buy') ? -1 * total : total\n                        if (end_shares.hasOwnProperty(ticker)) {\n                            end_shares[ticker] += share_delta\n                        } else {\n                            end_shares[ticker] = share_delta\n                        }\n                        end_cash += cash_delta\n                    }\n                }\n                new_quarter['end_shares'] = end_shares\n                new_quarter['end_cash'] = end_cash\n                new_quarter['end_transfersinvalue'] = end_transfersinvalue\n\n                // determine quarter-end ticker value\n                let self = this\n                let end_tickervalue = 0, end_tickerdate\n                let this_quote_month = quarter * 3\n                let this_quote_year = target_year\n                if (target_year === today_year && quarter === today_quarter) { // for a partial last period, use a previous month's quotes\n                    let quote_dates = []\n                    Object.entries(end_shares).forEach(function(position) {\n                        if (position[1] && self.props.all_monthly_quotes.hasOwnProperty(position[0])) {\n                            quote_dates.push(self.props.all_monthly_quotes[position[0]].monthly_dates_desc[0])\n                        }\n                    })\n                    let lastavailablequote_month_str, lastavailablequote_year_str\n                    [lastavailablequote_year_str, lastavailablequote_month_str] = quote_dates.sort().reverse()[0].split('-')\n                    let lastavailablequote_month = parseInt(lastavailablequote_month_str)\n                    let lastavailablequote_year = parseInt(lastavailablequote_year_str)\n                    if (lastavailablequote_month !== today_month || lastavailablequote_year !== today_year) { // allow the previous month's quotes only\n                        if (today_month === 1 && (lastavailablequote_month !== 12 || lastavailablequote_year !== today_year - 1)) {\n                            this_quote_month = 12\n                            this_quote_year = today_year - 1\n                        } else if (today_month !== 1 && (lastavailablequote_month !== today_month - 1 || lastavailablequote_year !== today_year)) {\n                            this_quote_month = today_month - 1\n                            this_quote_year = today_year\n                        }\n                    }\n                }\n                Object.entries(end_shares).forEach(function(position) {\n                    let error_message = ''\n                    let month_end_quote = self.getMonthEndQuote(position[0], this_quote_year, this_quote_month)\n                    if (month_end_quote === null) {\n                        error_message = 'ERROR: quote for symbol '+position[0]+' for month '+this_quote_year+'-'+this_quote_month+' is unavailable'\n                        end_tickervalue = 'err.'\n                        end_tickerdate = null\n                    } else {\n                        end_tickervalue += position[1] * month_end_quote.price\n                        if (typeof(end_tickerdate) !== 'string') {\n                            end_tickerdate = month_end_quote.date\n                        } else if (month_end_quote.date !== end_tickerdate) {\n                            error_message = 'ERROR: quote dates for month '+this_quote_year+'-'+this_quote_month+' do not match for all symbols ('+end_tickerdate+' & '+month_end_quote.date+')'\n                        }\n                    }\n                    self.setState({ error_message: error_message })\n                    if (error_message.length) {\n                        console.log(error_message)\n                    }\n                })\n                new_quarter['end_tickervalue'] = end_tickervalue\n                new_quarter['end_tickerdate'] = end_tickerdate\n                \n                // determine quarter-end total value\n                let end_totalvalue\n                if (typeof(end_tickervalue) !== 'number' || typeof(end_cash) !== 'number') {\n                    end_totalvalue = 'err.'\n                } else {\n                    end_totalvalue = end_tickervalue + end_cash\n                }\n                new_quarter['end_totalvalue'] = end_totalvalue\n                new_quarter['end_tickervaluefraction'] = end_tickervalue / end_totalvalue\n                new_quarter['end_cashfraction'] = end_cash / end_totalvalue\n\n                // determine quarter-end baseline value\n                let end_baselineprice, end_baselinedate\n                let end_baselinequote = self.getMonthEndQuote('S&P500', this_quote_year, this_quote_month)\n                if (end_baselinequote === null) {\n                    let error_message = 'ERROR: quote for symbol S&P500 for month '+this_quote_year+'-'+this_quote_month+' is unavailable'\n                    this.setState({ error_message: error_message })\n                    console.log(error_message)\n                    end_baselineprice = 'err.'\n                    end_baselinedate = null\n                } else {\n                    end_baselineprice = end_baselinequote.price\n                    end_baselinedate = end_baselinequote.price\n                }\n                new_quarter['end_baselineprice'] = end_baselineprice\n                new_quarter['end_baselinedate'] = end_baselinedate\n\n                // determine quarter-over-quarter performance\n                // HPR (holding period return) = end / prev_end - 1\n                // HPR (HPR, adjusted for transfers) = end / (prev_end + transfersIN) - 1\n                // transfersIN, adjusted for middle-of-period transfers... aka Modified Dietz method)\n                //   transfersIN = transferINa * fraction of period duration) + (transferINb * fraction of period duration)\n                let adjusted_transfer_value = 0\n                let zb_start_month = quarter * 3 - 3\n                let period_start_date = new Date(target_year, zb_start_month, 1)\n                let period_end_date\n                if (zb_start_month !== 3) {\n                    period_end_date = new Date(target_year, zb_start_month+3, 1)\n                } else {\n                    period_end_date = new Date(target_year+1, 1, 1)\n                }\n                let period_days = Math.round((period_end_date - period_start_date) / (1000 * 60 * 60 * 24))\n                new_quarter.transactions_of_cash.forEach(function(transaction) {\n                    let transfer_month, transfer_day, fraction_of_period\n                    [transfer_month, transfer_day] = [parseInt(transaction.date.split('-')[1]), parseInt(transaction.date.split('-')[2])]\n                    let transfer_date = new Date(target_year, transfer_month - 1, transfer_day)\n                    if (transaction.action === 'transferIN') {\n                        fraction_of_period = (period_end_date - transfer_date) / (1000 * 60 * 60 * 24) / period_days\n                        adjusted_transfer_value += transaction.total * fraction_of_period\n                    } else if (transaction.action === 'transferOUT') {\n                        fraction_of_period = (transfer_date - period_start_date) / (1000 * 60 * 60 * 24) / period_days\n                        adjusted_transfer_value -= transaction.total * fraction_of_period\n                    }\n                })\n                let performance\n                if (typeof(start_totalvalue) !== 'number' || typeof(end_totalvalue) !== 'number') {\n                    performance = 'err.'\n                } else if (start_tickervalue === 0 && end_tickervalue === 0) {\n                    performance = 0\n                } else {\n                    performance = (end_totalvalue / (start_totalvalue + adjusted_transfer_value)) - 1\n                }\n                new_quarter['qoq_change_pct'] = performance\n\n                // determine quarter-over-quarter baseline performance\n                performance = 'n/a'\n                if (typeof(start_baselineprice) !== 'number' || typeof(end_baselineprice) !== 'number') {\n                    performance = 'err.'\n                } else if (q === 0) {\n                    performance = (end_baselineprice / start_baselineprice) - 1\n                } else {\n                    performance = (end_baselineprice / quarter_data[q-1].end_baselineprice) - 1\n                }\n                new_quarter['qoq_baseline_change_pct'] = performance\n\n                // store the data object\n                quarter_data.push(new_quarter)\n            }\n        }\n\n        this.setState({ quarter_data: quarter_data })\n    }\n\n    getYear(date) {\n        return parseInt(date.split('-')[0])\n    }\n\n    getQuarter(date) {\n        return Math.floor((parseInt(date.split('-')[1])-1) / 3 + 1)\n    }\n\n    getMonth(date) {\n        return parseInt(date.split('-')[1])\n    }\n\n    numberWithCommas(x) {\n        return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n    }\n\n    formatCurrency(dollars) {\n        let prefix, retval = dollars\n        if (typeof(dollars) === 'number') {\n            let value = Math.round(dollars)\n            retval = this.numberWithCommas(Math.abs(value))\n            prefix = (value < 0 ) ? '-$' : '$'\n            retval = prefix + retval\n        } else {\n            retval = 'err.'\n        }\n        return retval\n    }\n\n    getDisplayedPerformance(quarter_data) {\n        let retval = {}\n        retval['key'] = quarter_data.year + 'Q' + quarter_data.quarter\n        retval['display_value'] = 'err.'\n        retval['baseline_value'] = 'err.'\n        retval['index_value'] = quarter_data.qoq_baseline_change_pct\n        let my_perf = quarter_data.qoq_change_pct\n        if (my_perf === 'err.') {\n            retval['display_value'] = 'err.'\n        } else if (typeof(my_perf) === 'number') {\n            if (this.props.baseline === 'sp500_pct_gain') {\n                let baseline_perf = quarter_data.qoq_baseline_change_pct\n                if (typeof(baseline_perf) !== 'number') {\n                    return retval\n                } else {\n                    retval['display_value'] = my_perf - baseline_perf\n                    retval['baseline_value'] = baseline_perf\n                }\n            } else {\n                retval['display_value'] = my_perf\n                retval['baseline_value'] = 0\n            }\n        }\n        return retval\n    }\n\n    getMonthEndQuote(ticker, year, month) {\n        let monthly_dates = this.props.all_monthly_quotes[ticker].monthly_dates_desc\n        let monthly_prices = this.props.all_monthly_quotes[ticker].monthly_prices\n        let quarter_idx = monthly_dates.findIndex( date => this.getYear(date) === year && this.getMonth(date) === month )\n        let retval = {}\n        if (quarter_idx !== -1) {\n            retval['date'] = monthly_dates[quarter_idx]\n            retval['price'] = monthly_prices[quarter_idx]\n        } else {\n            retval = null\n        }\n        return retval\n    }\n\n    styleCell(performance_obj) {\n        let displayed, baseline, index\n        [displayed, baseline, index] = [performance_obj.display_value, performance_obj.baseline_value, performance_obj.index_value]\n        let classes = 'performance-cell'\n        if ( this.props.baseline === 'sp500_pct_gain') {\n            if (displayed > 0) {\n                classes += ' text-green'\n            } else if (displayed < 0) {\n                classes += ' text-red'\n            }\n        } else {\n            if ( displayed < baseline || displayed < 0 ) {\n                classes += ' text-red'\n            } else if (displayed > index) {\n                classes += ' text-green'\n            }\n        }\n        return classes\n    }\n\n    formatPerformance(performance) {\n        if (performance === 'err.') {\n            return 'err.'\n        } else if (typeof(performance) !== 'number') {\n            return '-'\n        } else {\n            return (Math.round(performance * 100 * 10) / 10).toFixed(1) + '%'\n        }\n    }\n\n    formatWholePercentage(percentage) {\n        if (percentage === 'err.') {\n            return 'err.'\n        } else if (typeof(percentage) !== 'number' || isNaN(percentage)) {\n            return '?'\n        } else {\n            return (Math.round(percentage * 100)) + '%'\n        }\n    }\n\n    render() {\n        let displayed_performance = this.state.quarter_data.map( qdata => this.getDisplayedPerformance(qdata) )\n        return (\n            <div id=\"my-performance-wrapper\">\n                <div id=\"my-performance-body\">\n                    <div id=\"my-performance-rowlabels\">\n                        <table>\n                            <thead></thead>\n                            <tbody>\n                                <tr><th>&nbsp;</th></tr>\n                                <tr><th>stocks:</th></tr>\n                                <tr><th>cash:</th></tr>\n                                <tr><th>transfers in:</th></tr>\n                                <tr><th>total:</th></tr>\n                                <tr><th>Q-o-Q perf:</th></tr>\n                                <tr><th>S&amp;P500 perf:</th></tr>\n                            </tbody>\n                        </table>\n                    </div>\n                    <div id=\"my-performance\">\n                        <table>\n                            <thead>\n                                <tr>\n                                { this.state.quarter_data.map( qdata => ( // name\n                                    <th key={'name-'+qdata.year+qdata.quarter}>{qdata.name}</th>\n                                ))}\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr>\n                                { this.state.quarter_data.map( qdata => ( // ticker value\n                                    <td key={'tickervalue-'+qdata.year+qdata.quarter}>{this.formatCurrency(qdata.end_tickervalue)} ({this.formatWholePercentage(qdata.end_tickervaluefraction)})</td>\n                                ))}\n                                </tr>\n                                <tr>\n                                { this.state.quarter_data.map( qdata => ( // cash value\n                                    <td key={'cashvalue-'+qdata.year+qdata.quarter}>{this.formatCurrency(qdata.end_cash)} ({this.formatWholePercentage(qdata.end_cashfraction)})</td>\n                                ))}\n                                </tr>\n                                <tr>\n                                { this.state.quarter_data.map( qdata => ( // transfers in\n                                    <td key={'transfersin-'+qdata.year+qdata.quarter}>{this.formatCurrency(qdata.end_transfersinvalue)}</td>\n                                ))}\n                                </tr>\n                                <tr>\n                                { this.state.quarter_data.map( qdata => ( // total value\n                                    <th key={'totalvalue-'+qdata.year+qdata.quarter}>{this.formatCurrency(qdata.end_totalvalue)}</th>\n                                ))}\n                                </tr>\n                                <tr>\n                                { displayed_performance.map( performance => ( // my performance\n                                    <td key={performance.key} className={ this.styleCell(performance) }>{ this.formatPerformance(performance.display_value) }</td>\n                                ))}\n                                </tr>\n                                <tr>\n                                { displayed_performance.map( performance => ( // index performance\n                                    <td key={performance.key}>{ this.formatPerformance(performance.index_value) }</td>\n                                ))}\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                <div id=\"my-performance-footer\">\n                    <div id=\"error-message\">\n                        {this.state.error_message}\n                    </div>\n                </div>\n\n            </div>\n        )\n    }\n}\n\nMyPerformance.propTypes = {\n    all_transactions: PropTypes.array.isRequired,\n    all_positions: PropTypes.object.isRequired,\n    all_monthly_quotes: PropTypes.object.isRequired,\n    baseline: PropTypes.string.isRequired,\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class StatusMessages extends React.Component {\n\n    render() {\n        return (\n            <div id=\"status-messages-wrapper\">\n                { this.props.all_status_messages.length ? 'History:' : '' }\n                <div id=\"status-messages\">\n                { this.props.all_status_messages\n                    .map(\n                        (message, i) => {\n                            return (message.content.toLowerCase().startsWith(\"error\"))\n                            ? <p key={i + message.modified_at} className=\"message error\">{message.content}</p>\n                            : <p key={i + message.modified_at} className=\"message\">{message.content}</p>\n                        }\n                    )\n                }\n                </div>\n            </div>\n        )\n    }\n}\n\nStatusMessages.propTypes = {\n    all_status_messages: PropTypes.array.isRequired,\n}","import React from 'react'\nimport PropTypes from 'prop-types'\n\n\nexport class WhatIf extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            balanceable_value: 0,\n            balance_target_set: 'my_holdings',\n            balance_target_column: 'current_value',\n            sell_all_of: ['sell_none'],\n            cash_treatment: 'ignore',\n            cash_remaining: '$0',\n            cash_valid: true\n        }\n        this.handleChange = this.handleChange.bind(this)\n        this.handleSubmit = this.handleSubmit.bind(this)\n        this.isDisabled = this.isDisabled.bind(this)\n        this.numberWithCommas = this.numberWithCommas.bind(this)\n    }\n\n    componentDidMount() {\n        let new_balanceable_value = Math.round(this.props.get_balanceable_value(this.state.balance_target_set, this.state.balance_target_column))\n        this.setState({ balanceable_value: new_balanceable_value })\n\n        const stored_balance_target_set = JSON.parse(localStorage.getItem(\"balance_target_set\"))\n        if (stored_balance_target_set !== null) {\n            this.setState({ balance_target_set: stored_balance_target_set })\n        }\n\n        const stored_balance_target_column = JSON.parse(localStorage.getItem(\"balance_target_column\"))\n        if (stored_balance_target_column !== null) {\n            this.setState({ balance_target_column: stored_balance_target_column })\n        }\n\n        const stored_cash_treatment = JSON.parse(localStorage.getItem(\"cash_treatment\"))\n        if (stored_cash_treatment !== null) {\n            this.setState({ cash_treatment: stored_cash_treatment })\n        }\n\n        const stored_cash_remaining = JSON.parse(localStorage.getItem(\"cash_remaining\"))\n        if (stored_cash_remaining !== null) {\n            this.setState({ cash_remaining: stored_cash_remaining })\n        }\n    }\n\n    handleChange(event) {\n\n        let {name, value, selectedOptions } = event.target\n\n        // when the balance target set input changes, update the maximum value\n        if (name === 'balance_target_set') {\n            let new_balanceable_value = Math.round(this.props.get_balanceable_value(value, this.state.balance_target_column))\n            this.setState({ balanceable_value: new_balanceable_value })\n        }\n\n        // when the balance target column input changes, update the maximum value\n        if (name === 'balance_target_column') {\n            let new_balanceable_value = Math.round(this.props.get_balanceable_value(this.state.balance_target_set, value))\n            this.setState({ balanceable_value: new_balanceable_value })\n        }\n\n        // when the cash remaining input changes, validate the user's value\n        if (name === 'cash_remaining') {\n            let user_whole_dollars_string = value.replace('$','').split('.')[0]\n            let user_whole_dollars = parseInt(user_whole_dollars_string)\n            let valid_whole_dollars_string = value.replace(/[^0-9.,]/g,'').split('.')[0]\n            if (valid_whole_dollars_string.length \n                && user_whole_dollars_string === valid_whole_dollars_string \n                && user_whole_dollars >= 0\n                && user_whole_dollars <= this.state.balanceable_value) { \n                this.setState({ cash_valid: true })\n            } else {\n                this.setState({ cash_valid: false })\n            }\n        }\n\n        // update local storage\n        localStorage.setItem(name, JSON.stringify(value))\n\n        // mirror the input in state, since this is a (React) controlled input\n        if (name !== 'sell_all_of') {\n            this.setState({ [name]: value })\n        } else {\n            let multiple_tickers = Array.from(selectedOptions, (item) => item.value)\n            if (multiple_tickers.includes('sell_none')) {\n                multiple_tickers = ['sell_none']\n            }\n            this.setState({ sell_all_of: multiple_tickers })\n        }\n    }\n\n    handleSubmit(event) {\n        event.preventDefault()\n        let user_remaining_cash = this.state.cash_remaining.split('.')[0].replace(/[^0-9]/g, \"\")\n        let remaining_cash = (this.state.cash_treatment === 'ignore') ? null : parseInt(user_remaining_cash)\n        this.props.on_whatif_submit(this.state.balance_target_set, this.state.sell_all_of, this.state.balance_target_column, remaining_cash)\n    }\n\n    isDisabled() {\n\n        if (this.state.cash_treatment === 'include' && !this.state.cash_valid) {\n            return true\n        } else if (this.state.balance_target_set === 'my_holdings') {\n            return (this.props.show_holdings) ? false : true\n        } else if (this.state.balance_target_set === 'untagged') {\n            return (this.props.show_untagged) ? false : true\n        } else {\n            return (this.props.show_tagged) ? false : true\n        }\n    }\n\n    numberWithCommas(x) {\n        return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n    }\n\n    render() {\n        let excludable_tickers = []\n        if (this.state.balance_target_set === \"my_holdings\") {\n            excludable_tickers = Object.keys(this.props.all_positions).filter( ticker => ticker !== 'cash' && this.props.all_positions[ticker].current_shares)\n        } else if (this.props.all_tags.hasOwnProperty(this.state.balance_target_set)) {\n            excludable_tickers = this.props.all_tags[this.state.balance_target_set].filter( ticker => this.props.all_positions[ticker] && this.props.all_positions[ticker].current_shares)\n        }\n        return (\n            <section id=\"what-if\">\n                <form onSubmit={this.handleSubmit} onReset={this.handleReset}>\n                    <div id=\"operation\">Balance&nbsp;\n                        <select name=\"balance_target_set\" value={this.state.balance_target_set} onChange={this.handleChange}>\n                            <option value=\"my_holdings\">my holdings ({Object.keys(this.props.all_positions).filter(position => position !== 'cash').length})</option>\n                            <option value=\"untagged\">untagged tickers ({this.props.all_tags.untagged.length})</option>\n                            {Object.entries(this.props.all_tags).filter(entry => entry[1].length).map(entry => entry[0]).sort().filter(tag => tag !== 'untagged').map(tag => \n                                <option key={tag} value={tag}>tag: {tag} ({this.props.all_tags[tag].length})</option>\n                            )}\n                        </select>\n                        &nbsp;into&nbsp; \n                        <select name=\"balance_target_column\" value={this.state.balance_target_column} onChange={this.handleChange}>\n                            <option value=\"current_value\">equal values</option>\n                            <option value=\"value_at_risk\">equal values, risk adjusted</option>\n                            <option value=\"basis\">equal bases</option>\n                            <option value=\"basis_risked\">equal bases, risk adjusted</option>\n                            <option value=\"only_profits\">only profits remaining</option>\n                        </select>\n                        , but sell all of&nbsp;\n                        <select name=\"sell_all_of\" value={this.state.sell_all_of} multiple={true} onChange={this.handleChange}>\n                            <option value=\"sell_none\">(none. keep all.)</option>\n                            {excludable_tickers.sort().map(ticker => \n                                <option key={ticker} value={ticker}> {ticker} </option>\n                            )}\n                        </select>\n                        &nbsp;...\n                    </div>\n                    <div id=\"cash-treatment\">\n                        <label htmlFor=\"ignore\"><input type=\"radio\" id=\"ignore\" name=\"cash_treatment\" value=\"ignore\" selected onChange={this.handleChange} defaultChecked />ignoring my cash balance</label>\n                        <label htmlFor=\"include\"><input type=\"radio\" id=\"include\" name=\"cash_treatment\" value=\"include\" onChange={this.handleChange} disabled={!this.props.show_cash} />using my cash balance, and leaving at least\n                        <input type=\"text\" id=\"cash_remaining\" name=\"cash_remaining\" size=\"12\" onChange={this.handleChange} value={this.state.cash_remaining} placeholder=\"$0\"></input>cash remaining (max: ${this.numberWithCommas(this.state.balanceable_value)})</label>\n                    </div>\n                    <section className=\"buttonrow\">\n                        <input className=\"btn btn-sm btn-primary\" type=\"submit\" value=\"What If?\" disabled={this.isDisabled()}/>\n                    </section>\n                </form>\n            </section>\n        )\n    }\n}\n\nWhatIf.propTypes = {\n    all_current_quotes: PropTypes.object,\n    all_tags: PropTypes.object,\n    all_positions: PropTypes.object,\n    get_balanceable_value: PropTypes.func,\n    show_holdings: PropTypes.bool,\n    show_tagged: PropTypes.bool,\n    show_untagged: PropTypes.bool,\n    show_cash: PropTypes.bool,\n    on_whatif_submit: PropTypes.func\n}","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { AddTicker } from './AddTicker'\nimport { AddTag } from './AddTag'\nimport { AddTransaction } from './AddTransaction'\nimport { TransactionLog } from './TransactionLog'\nimport { DeleteTag } from './DeleteTag'\nimport { MyPerformance } from './MyPerformance'\nimport { StatusMessages } from './StatusMessages'\nimport { WhatIf } from './WhatIf'\n\n\nexport class InputForms extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            which_inputs: \"tickers\" // tickers | tags | transactions | my-performance | what-ifs | logs\n        }\n        this.onWhichInputs = this.onWhichInputs.bind(this)\n    }\n\n    componentDidMount() {\n        const stored_which_inputs = JSON.parse(localStorage.getItem(\"which_inputs\"))\n        if (stored_which_inputs !== null) {\n            this.setState({ which_inputs: stored_which_inputs })\n        }\n    }\n\n    onWhichInputs(new_which_inputs) {\n        localStorage.setItem('which_inputs', JSON.stringify(new_which_inputs))\n        this.setState({ which_inputs: new_which_inputs })\n    }\n\n    render() {\n        return (\n            <div id=\"input-forms\">\n                <section id=\"input-form-selectors\">\n                    <span className={\"input-form-selector\" + (this.state.which_inputs===\"tickers\" ? \" selected\" : \"\") } onClick={ (e)=>this.onWhichInputs('tickers')}>Tickers</span>\n                    <span className={\"input-form-selector\" + (this.state.which_inputs===\"tags\" ? \" selected\" : \"\") } onClick={ (e)=>this.onWhichInputs('tags')}>Tags</span>\n                    <span className={\"input-form-selector\" + (this.state.which_inputs===\"transactions\" ? \" selected\" : \"\") } onClick={ (e)=>this.onWhichInputs('transactions')}>Transactions</span>\n                    <span className={\"input-form-selector\" + (this.state.which_inputs===\"my-performance\" ? \" selected\" : \"\") } onClick={ (e)=>this.onWhichInputs('my-performance')}>Performance</span>\n                    <span className={\"input-form-selector\" + (this.state.which_inputs===\"what-ifs\" ? \" selected\" : \"\") } onClick={ (e)=>this.onWhichInputs('what-ifs')}>What If?</span>\n                    <span className={\"input-form-selector\" + (this.state.which_inputs===\"logs\" ? \" selected\" : \"\") } onClick={ (e)=>this.onWhichInputs('logs')}>Logs</span>\n                </section>\n                <section id=\"input-form-forms\">\n                    {this.state.which_inputs === 'tickers' && (\n                        <React.Fragment>\n                        <AddTicker\n                            all_stocks={this.props.all_stocks}\n                            all_tags={this.props.all_tags}\n                            on_new_tickers={this.props.on_new_tickers}\n                            create_message={this.props.create_message}\n                            on_new_messages={this.props.on_new_messages}\n                        />\n                        </React.Fragment>\n                    )}\n                    {this.state.which_inputs === 'tags' && (\n                        <React.Fragment>\n                        <AddTag\n                            all_tags={this.props.all_tags}\n                            on_new_tags={this.props.on_new_tags}\n                            create_message={this.props.create_message}\n                            on_new_messages={this.props.on_new_messages}\n                        />\n                        <DeleteTag\n                            all_tags={this.props.all_tags}\n                            on_delete_tag={this.props.on_delete_tag}\n                        />\n                        </React.Fragment>\n                    )}\n                    {this.state.which_inputs === 'transactions' && (\n                    <React.Fragment>\n                        <div className=\"content-wrapper\">\n                            <div className=\"content-half\">\n                                <AddTransaction\n                                    all_stocks={this.props.all_stocks}\n                                    all_tags={this.props.all_tags}\n                                    on_new_transaction={this.props.on_new_transaction}\n                                    on_new_cash={this.props.on_new_cash}\n                                    create_message={this.props.create_message}\n                                    on_new_messages={this.props.on_new_messages}\n                                />\n                            </div>\n                            <div className=\"content-half\">\n                                <TransactionLog\n                                    all_transactions={this.props.all_transactions}\n                                    all_risk={this.props.all_risk}\n                                    on_delete_transaction={this.props.on_delete_transaction}\n                                    on_import_transactions={this.props.on_import_transactions}\n                                />\n                            </div>\n                        </div>\n                    </React.Fragment>\n                    )}\n                    {this.state.which_inputs === 'what-ifs' && (\n                        <React.Fragment>\n                        <WhatIf\n                            all_current_quotes={this.props.all_current_quotes}\n                            all_positions={this.props.all_positions}\n                            all_tags={this.props.all_tags}\n                            get_balanceable_value={this.props.get_balanceable_value}\n                            show_holdings={this.props.show_holdings}\n                            show_tagged={this.props.show_tagged}\n                            show_untagged={this.props.show_untagged}\n                            show_cash={this.props.show_cash}\n                            on_whatif_submit={this.props.on_whatif_submit}\n                        />\n                        </React.Fragment>\n                    )}\n                    {this.state.which_inputs === 'my-performance' && (\n                        <React.Fragment>\n                        <MyPerformance\n                            all_transactions={this.props.all_transactions}\n                            all_positions={this.props.all_positions}\n                            all_monthly_quotes={this.props.all_monthly_quotes}\n                            baseline={this.props.baseline}\n                        />\n                        </React.Fragment>\n                    )}\n                    {this.state.which_inputs === 'logs' && (\n                        <React.Fragment>\n                        <StatusMessages\n                            all_status_messages={this.props.all_status_messages}\n                        />\n                        </React.Fragment>\n                    )}\n                </section>\n            </div>\n        )\n    }\n}\n\nInputForms.propTypes = {\n    all_stocks: PropTypes.array.isRequired,\n    all_tags: PropTypes.object.isRequired,\n    all_current_quotes: PropTypes.object,\n    all_monthly_quotes: PropTypes.object,\n    all_positions: PropTypes.object,\n    all_transactions: PropTypes.array,\n    all_risk: PropTypes.object,\n    show_tagged: PropTypes.bool,\n    show_untagged: PropTypes.bool,\n    show_cash: PropTypes.bool,\n    baseline: PropTypes.string,\n    get_balanceable_value: PropTypes.func,\n    on_new_tickers: PropTypes.func.isRequired,\n    on_new_cash: PropTypes.func.isRequired,\n    on_new_tags: PropTypes.func.isRequired,\n    on_delete_tag: PropTypes.func.isRequired,\n    on_new_transaction: PropTypes.func.isRequired,\n    on_delete_transaction: PropTypes.func.isRequired,\n    on_import_transactions: PropTypes.func.isRequired,\n    create_message: PropTypes.func.isRequired,\n    all_status_messages: PropTypes.array.isRequired,\n    on_new_messages: PropTypes.func.isRequired,\n    on_whatif_submit: PropTypes.func\n}","import React from 'react'\nimport 'bootstrap/dist/css/bootstrap.min.css'\nimport { GridHeaderRow } from './components/GridHeaderRow'\nimport { GridRow } from './components/GridRow'\nimport { GridRowTotals } from './components/GridRowTotals'\nimport { InputForms } from './components/InputForms'\nimport { Popover } from 'react-bootstrap'\nimport { OverlayTrigger } from 'react-bootstrap'\n\n\nconst all_columns = [\n    {\n        name: 'symbol',\n        display_name: 'Symbol',\n        type: 'string'\n    },\n    {\n        name: 'current_shares',\n        display_name: 'Shares',\n        type: 'number',\n        num_decimals: 0\n    },\n    {\n        name: 'whatif_current_shares',\n        display_name: 'What-If Shares',\n        type: 'number',\n        num_decimals: 0\n    },\n    {\n        name: 'current_price',\n        display_name: 'Price',\n        type: 'currency',\n        num_decimals: 2\n    },\n    // this column is too short-term ;-P\n    // {\n    //     name: 'change_pct',\n    //     display_name: 'Change',\n    //     type: 'percentage',\n    //     num_decimals: 2\n    // },\n    {\n        name: 'quote_date',\n        display_name: 'Price Date',\n        type: 'string'\n    },\n    {\n        name: 'current_value',\n        display_name: 'Value',\n        type: 'currency',\n        num_decimals: 0\n    },\n    {\n        name: 'whatif_current_value',\n        display_name: 'What-If Value',\n        type: 'currency',\n        num_decimals: 0\n    },\n    {\n        name: 'percent_value',\n        display_name: 'Pct of Total Value',\n        type: 'percentage',\n        num_decimals: 1\n    },\n    {\n        name: 'basis',\n        display_name: 'Basis',\n        type: 'currency',\n        num_decimals: 0\n    },\n    {\n        name: 'whatif_basis',\n        display_name: 'What-If Basis',\n        type: 'currency',\n        num_decimals: 0\n    },\n    {\n        name: 'percent_basis',\n        display_name: 'Pct of Total Basis',\n        type: 'percentage',\n        num_decimals: 1\n    },\n    {\n        name: 'percent_profit',\n        display_name: 'Pct Profit',\n        type: 'percentage',\n        passthrough_strings: true,\n        num_decimals: 1\n    },\n    {\n        name: 'realized_gains',\n        display_name: 'Realized',\n        type: 'currency',\n        num_decimals: 0\n    },\n    {\n        name: 'risk_factor_modified',\n        display_name: 'Risk Factor Edited Date',\n        type: 'string',\n    },\n    {\n        name: 'risk_factor',\n        display_name: 'Risk Factor (default=0.20)',\n        type: 'number',\n        num_decimals: 2\n    },\n    {\n        name: 'value_at_risk',\n        display_name: 'Value At Risk',\n        type: 'currency',\n        num_decimals: 0\n    },\n    {\n        name: 'whatif_value_at_risk',\n        display_name: 'What-If Value At Risk',\n        type: 'currency',\n        num_decimals: 0\n    },\n    {\n        name: 'basis_risked',\n        display_name: 'Basis Risked',\n        type: 'currency',\n        num_decimals: 0\n    },\n    {\n        name: 'whatif_basis_risked',\n        display_name: 'What-If Basis Risked',\n        type: 'currency',\n        num_decimals: 0\n    },\n    {\n        name: 'volume',\n        display_name: 'Volume',\n        type: 'number',\n        num_decimals: 0\n    },\n    {\n        name: 'dollar_volume',\n        display_name: 'Dollar Vol (M)',\n        type: 'currency',\n        scaling_power: -6,\n        num_decimals: 0\n    },\n    {\n        name: 'start_date',\n        display_name: 'Holding Started Date',\n        type: 'string'\n    },\n    {\n        name: 'short_change_pct',\n        display_name: '6-month',\n        type: 'percentage',\n        num_decimals: 1\n    },\n    {\n        name: 'medium_change_pct',\n        display_name: '1-year',\n        type: 'percentage',\n        num_decimals: 1\n    },\n    {\n        name: 'long_change_pct',\n        display_name: '2-year',\n        type: 'percentage',\n        num_decimals: 1\n    }\n]\n\nconst default_shown_columns = ['symbol', 'current_shares', 'current_value', 'percent_value', 'percent_basis', 'percent_profit', 'short_change_pct', 'medium_change_pct', 'long_change_pct']\n\nexport class ComparingStocks extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n\n            allIndiciesTickers: [ 'INX' ],\n            allIndiciesAliases: [ 'S&P500' ],\n            allStocks: [],\n            allCurrentQuotes: {},\n            allMonthlyQuotes: {},\n            allPositions: {},\n            allTransactions: [],\n            allTags: {\n                'untagged': []\n            },\n            allPerformanceNumbers: {},\n            allRisk: {},\n            allWhatifs: {},\n\n            whatif_format: 'deltas', // deltas | new_values\n            balance_target_set: 'my_holdings',\n            balance_target_column: '',\n            sell_all_of: [],\n            remaining_cash: null,\n            last_error_messages: [],\n            all_status_messages: [],\n            baseline: {\n                name: 'zero_pct_gain',\n                short_change_pct: 0,\n                medium_change_pct: 0,\n                long_change_pct: 0,\n            },\n            editing_row: null,\n\n            aggrPerformance: {},\n            aggrBasis: {},\n            aggrRealized: {},\n            aggrTotalValue: {},\n\n            show_holdings: true,\n            show_tagged: true,\n            show_untagged: true,\n            show_index: false,\n            show_cash: false,\n            show_aggregates: true,\n            show_only_achieved_performance: false,\n            sort_column: 'symbol',\n            sort_dir_asc: true,\n            shown_columns: [],\n\n            done: false\n        }\n        this.tickerIsIndex = this.tickerIsIndex.bind(this)\n        this.convertNameForIndicies = this.convertNameForIndicies.bind(this)\n        this.getTransactionById = this.getTransactionById.bind(this)\n        this.getTransactionsByTicker = this.getTransactionsByTicker.bind(this)\n        this.getPositionFromSingleTickerTransactions = this.getPositionFromSingleTickerTransactions.bind(this)\n        this.getPositionFromCashTransactions = this.getPositionFromCashTransactions.bind(this)\n        this.calculateAggrPositionInfo = this.calculateAggrPositionInfo.bind(this)\n        this.calculateAggrPerformance = this.calculateAggrPerformance.bind(this)\n        this.populateSymbolCount = this.populateSymbolCount.bind(this)\n        this.onInputChange = this.onInputChange.bind(this)\n        this.onShowInputChange = this.onShowInputChange.bind(this)\n        this.onChangeWhatifFormat = this.onChangeWhatifFormat.bind(this)\n        this.onChangeSort = this.onChangeSort.bind(this)\n        this.showColumns = this.showColumns.bind(this)\n        this.createMessage = this.createMessage.bind(this)\n        this.onToggleShowColumn = this.onToggleShowColumn.bind(this)\n        this.onNewTransaction = this.onNewTransaction.bind(this)\n        this.onImportTransactions = this.onImportTransactions.bind(this)\n        this.onNewCash = this.onNewCash.bind(this)\n        this.onNewTags = this.onNewTags.bind(this)\n        this.onNewTickers = this.onNewTickers.bind(this)\n        this.onRemoveFromTag = this.onRemoveFromTag.bind(this)\n        this.onDeleteTicker = this.onDeleteTicker.bind(this)\n        this.onDeleteTag = this.onDeleteTag.bind(this)\n        this.onDeleteTransaction = this.onDeleteTransaction.bind(this)\n        this.onEditCell = this.onEditCell.bind(this)\n        this.onModifyRiskFactor = this.onModifyRiskFactor.bind(this)\n        this.onEscapeKey = this.onEscapeKey.bind(this)\n        this.onNewMessages = this.onNewMessages.bind(this)\n        this.getCurrentValue = this.getCurrentValue.bind(this)\n        this.getCurrentShares = this.getCurrentShares.bind(this)\n        this.getBasis = this.getBasis.bind(this)\n        this.getBalanceableValue = this.getBalanceableValue.bind(this)\n        this.onWhatifSubmit = this.onWhatifSubmit.bind(this)\n        this.onWhatifGo = this.onWhatifGo.bind(this)\n        this.getIndicies = this.getIndicies.bind(this)\n        this.getHoldings = this.getHoldings.bind(this)\n        this.getAdded = this.getAdded.bind(this)\n        this.getTagged = this.getTagged.bind(this)\n        this.getUntagged = this.getUntagged.bind(this)\n        this.nameIsAnAggregate = this.nameIsAnAggregate.bind(this)\n        this.nameIsSpecial = this.nameIsSpecial.bind(this)\n        this.sortTickers = this.sortTickers.bind(this)\n    }\n\n    componentDidMount() {\n\n        // 1. load all locally-stored data\n\n        const stored_sort_column = JSON.parse(localStorage.getItem(\"sort_column\"))\n        if (stored_sort_column !== null) {\n            this.setState({ sort_column: stored_sort_column })\n        }\n\n        const stored_sort_dir_asc = JSON.parse(localStorage.getItem(\"sort_dir_asc\"))\n        if (stored_sort_dir_asc !== null) {\n            this.setState({ sort_dir_asc: stored_sort_dir_asc })\n        }\n\n        const stored_whatif_format = JSON.parse(localStorage.getItem(\"whatif_format\"))\n        if (stored_whatif_format !== null) {\n            this.setState({ whatif_format: stored_whatif_format })\n        }\n\n        let allTags = {}\n        const stored_allTags = JSON.parse(localStorage.getItem(\"allTags\"))\n        if (stored_allTags !== null) {\n            this.setState({ allTags: stored_allTags })\n            allTags = JSON.parse(JSON.stringify(stored_allTags))\n        }\n\n        let allTransactions = []\n        const stored_allTransactions = JSON.parse(localStorage.getItem(\"allTransactions\"))\n        if (stored_allTransactions !== null) {\n            this.setState({ allTransactions: stored_allTransactions })\n            allTransactions = JSON.parse(JSON.stringify(stored_allTransactions))\n        }\n\n        const stored_allRisk = JSON.parse(localStorage.getItem(\"allRisk\"))\n        if (stored_allRisk !== null) {\n            this.setState({ allRisk: stored_allRisk })\n        }\n\n        let self = this\n\n        const view_controls = ['show_holdings', 'show_tagged', 'show_untagged', 'show_index', 'show_cash', 'show_aggregates', 'show_only_achieved_performance']\n        let stored_controls = {}\n        view_controls.forEach(function(control) {\n            stored_controls[control] = null\n            const stored_control = JSON.parse(localStorage.getItem(control))\n            if (stored_control !== null) {\n                stored_controls[control] = stored_control\n                self.setState({ [control]: stored_control })\n            }\n        })\n\n        let init_shown_columns = []\n        const stored_shown_columns = JSON.parse(localStorage.getItem(\"shown_columns\"))\n        if (stored_shown_columns !== null) {\n            init_shown_columns = [...stored_shown_columns]\n        } else {\n            init_shown_columns = all_columns.filter(column => default_shown_columns.includes(column.name))\n        }\n\n\n        // 2. calculate historical performance data for each added ticker\n\n        let baseline = {}\n        const stored_baseline = JSON.parse(localStorage.getItem(\"baseline\"))\n        if (stored_baseline !== null) {\n            baseline = Object.assign({}, stored_baseline)\n        } else {\n            baseline = {\n                name: 'zero_pct_gain',\n                short_pct_gain: 0,\n                medium_pct_gain: 0,\n                long_pct_gain: 0,\n            }\n        }\n\n        let indexed_risk_data = {}\n        if (stored_allRisk !== null) {\n            indexed_risk_data = JSON.parse(JSON.stringify(stored_allRisk))\n        }\n\n        let raw_current_quote_data = require('./api/sample_current_quotes.json').sample_current_quotes\n        let indexed_current_quote_data = {}\n        raw_current_quote_data.forEach(function(raw_quote) {\n            let adjusted_ticker = self.convertNameForIndicies(raw_quote['Global Quote']['01. symbol'].toUpperCase())\n            indexed_current_quote_data[adjusted_ticker] = raw_quote\n        })\n\n        let raw_monthly_quote_data = require('./api/sample_monthly_quotes.json').sample_monthly_quotes\n        let indexed_monthly_quote_data = {}\n        let index_performance = {}\n        raw_monthly_quote_data.forEach(function(raw_quote) {\n            let adjusted_ticker = self.convertNameForIndicies(raw_quote['Meta Data']['2. Symbol'].toUpperCase())\n            indexed_monthly_quote_data[adjusted_ticker] = raw_quote\n            if (adjusted_ticker === 'S&P500') {\n                let quoteTimeSeriesDesc = Object.entries(indexed_monthly_quote_data[adjusted_ticker]['Monthly Adjusted Time Series'])\n                .sort(function(a,b) {\n                    if(a[0] < b[0]) {\n                        return 1\n                    } else if (a[0] > b[0]) {\n                        return -1\n                    } else {\n                        return 0\n                    }\n                })\n                let monthly_prices = Object.entries(quoteTimeSeriesDesc).map(price => parseFloat(price[1]['5. adjusted close']))\n                let now = monthly_prices[0]\n                let prev_short = monthly_prices[5]\n                let prev_medium = monthly_prices[11]\n                let prev_long = monthly_prices[23]\n                index_performance['short_change_pct'] = (now - prev_short) / now * 100\n                index_performance['medium_change_pct'] = (now - prev_medium) / now * 100\n                index_performance['long_change_pct'] = (now - prev_long) / now * 100\n                baseline['short_change_pct'] = index_performance['short_change_pct']\n                baseline['medium_change_pct'] = index_performance['medium_change_pct']\n                baseline['long_change_pct'] = index_performance['long_change_pct']\n                self.setState({ baseline: baseline })\n                localStorage.setItem('baseline', JSON.stringify(baseline))\n            }\n        })\n\n        this.setState({ index_performance: index_performance })\n\n\n        // 3. calculate position data (from transactions) for all holdings\n\n        let all_stocks = []\n        allTransactions.forEach(function(transaction) {\n            if (!all_stocks.includes(transaction.ticker)) {\n                all_stocks.push(transaction.ticker)\n            }\n        })\n        Object.keys(indexed_current_quote_data).forEach(function(ticker) {\n            if (!all_stocks.includes(ticker)) {\n                all_stocks.push(ticker)\n            }\n        })\n        Object.keys(indexed_monthly_quote_data).forEach(function(ticker) {\n            if (!all_stocks.includes(ticker)) {\n                all_stocks.push(ticker)\n            }\n        })\n        Object.keys(indexed_risk_data).forEach(function(ticker) {\n            if (!all_stocks.includes(ticker)) {\n                all_stocks.push(ticker)\n            }\n        })\n        all_stocks = all_stocks.filter(ticker => ticker !== 'cash')\n\n        let newPositions = {}\n        let newCurrentQuotes = {}\n        let newMonthlyQuotes = {}\n        let newPerformanceNumbers = {}\n        let newRisk = {}\n        let cash_delta_from_stock_transactions = 0\n\n        all_stocks.forEach(function(ticker) {\n\n            // create a stock position if any transactions exist\n            allTransactions.forEach(function(transaction) {\n                if (!newPositions.hasOwnProperty(transaction.ticker) && transaction.ticker !== 'cash') {\n                    let newPosition = {}\n                    let ticker = transaction.ticker\n                    newPosition = self.getPositionFromSingleTickerTransactions(allTransactions.filter(transaction => transaction.ticker === ticker))\n                    newPosition['symbol'] = ticker\n                    newPositions[ticker] = newPosition\n                    if (transaction.action === 'buy') {\n                        cash_delta_from_stock_transactions -= transaction.total\n                    } else {\n                        cash_delta_from_stock_transactions += transaction.total\n                    }\n                }\n            })\n\n            // get current quote\n            if (indexed_current_quote_data.hasOwnProperty(ticker)) {\n                let newCurrentQuote = {}\n                let quoteResult = indexed_current_quote_data[ticker]['Global Quote']\n                newCurrentQuote['symbol'] = ticker\n                newCurrentQuote['current_price'] = parseFloat((Math.round(100 * parseFloat(quoteResult['05. price'])) / 100).toFixed(2))\n                newCurrentQuote['change'] = parseFloat((Math.round(100 * parseFloat(quoteResult['09. change'])) / 100).toFixed(2))\n                newCurrentQuote['change_pct'] = parseFloat((Math.round(100 * parseFloat(quoteResult['10. change percent'].slice(0, -1))) / 100).toFixed(2))\n                newCurrentQuote['volume'] = parseInt(quoteResult['06. volume'])\n                newCurrentQuote['quote_date'] = quoteResult['07. latest trading day']\n                newCurrentQuotes[ticker] = newCurrentQuote\n            }\n\n            // get monthly quote\n            if (indexed_monthly_quote_data.hasOwnProperty(ticker)) {\n                let newMonthlyQuote = {}\n                let quoteTimeSeriesDesc = Object.entries(indexed_monthly_quote_data[ticker]['Monthly Adjusted Time Series'])\n                    .sort(function(a,b) {\n                        if(a[0] < b[0]) {\n                            return 1\n                        } else if (a[0] > b[0]) {\n                            return -1\n                        } else {\n                            return 0\n                        }\n                    })\n                newMonthlyQuote['symbol'] = ticker\n\n                let monthly_prices = []\n                let monthly_dates = []\n                quoteTimeSeriesDesc.forEach(function(price) {\n                    monthly_prices.push(parseFloat(price[1]['5. adjusted close']))\n                    monthly_dates.push(price[0])\n                })\n                newMonthlyQuote['monthly_prices'] = monthly_prices\n                newMonthlyQuote['monthly_dates_desc'] = monthly_dates\n                newMonthlyQuotes[ticker] = newMonthlyQuote\n\n                // calculate performance\n                let newPerformance = {}\n                let ticker_now = newMonthlyQuote['monthly_prices'][0]\n                let ticker_prev_short = newMonthlyQuote['monthly_prices'][5]\n                let ticker_prev_medium = newMonthlyQuote['monthly_prices'][11]\n                let ticker_prev_long = newMonthlyQuote['monthly_prices'][23]\n                let ticker_perf_short = (ticker_now - ticker_prev_short) / ticker_now * 100\n                let ticker_perf_medium = (ticker_now - ticker_prev_medium) / ticker_now * 100\n                let ticker_perf_long = (ticker_now - ticker_prev_long) / ticker_now * 100\n                if (baseline.name === 'sp500_pct_gain') {\n                    newPerformance['short_change_pct'] = ticker_perf_short - index_performance.short_change_pct\n                    newPerformance['medium_change_pct'] = ticker_perf_medium - index_performance.medium_change_pct\n                    newPerformance['long_change_pct'] = ticker_perf_long - index_performance.long_change_pct\n                } else {\n                    newPerformance['short_change_pct'] = ticker_perf_short\n                    newPerformance['medium_change_pct'] = ticker_perf_medium\n                    newPerformance['long_change_pct'] = ticker_perf_long\n                }\n                newPerformanceNumbers[ticker] = newPerformance\n            }\n\n            // get risk factor\n            if (indexed_risk_data.hasOwnProperty(ticker)) {\n                newRisk[ticker] = JSON.parse(JSON.stringify(indexed_risk_data[ticker]))\n            }\n        })\n\n        // quote for cash\n        let cashCurrentQuote = {\n            change: 0,\n            change_pct: 0,\n            current_price: 1,\n            symbol: 'cash',\n            volume: 0\n        }\n        newCurrentQuotes['cash'] = cashCurrentQuote\n\n        // performance for cash\n        let cashPerformance = {\n            short_change_pct: 0,\n            medium_change_pct: 0,\n            long_change_pct: 0,\n        }\n        newPerformanceNumbers['cash'] = cashPerformance\n\n        // position for cash\n        let cash_transactions = allTransactions.filter(transaction => transaction.ticker === 'cash')\n        if (cash_transactions.length || cash_delta_from_stock_transactions !== 0) {\n            let newPosition = {}\n            newPosition = this.getPositionFromCashTransactions(cash_transactions)\n            newPosition['symbol'] = 'cash'\n            if (cash_delta_from_stock_transactions) {\n                newPosition['basis'] += cash_delta_from_stock_transactions\n                newPosition['current_shares'] += cash_delta_from_stock_transactions\n            }\n            newPositions['cash'] = newPosition\n        }\n\n        // 5. handle aggregates\n        let aggr_position_info = JSON.parse(JSON.stringify(this.calculateAggrPositionInfo(allTags, newPositions, newCurrentQuotes, stored_controls['show_holdings'], stored_controls['show_cash'])))\n        let aggr_performance = JSON.parse(JSON.stringify(this.calculateAggrPerformance(allTags, newPerformanceNumbers)))\n\n\n        // 6. update the app's state with all of the above changes\n\n        this.setState({ allStocks: all_stocks,\n                        allPositions: newPositions,\n                        allCurrentQuotes: newCurrentQuotes,\n                        allMonthlyQuotes: newMonthlyQuotes,\n                        allPerformanceNumbers: newPerformanceNumbers,\n                        allRisk: newRisk,\n                        aggrBasis: aggr_position_info[0],\n                        aggrRealized: aggr_position_info[1],\n                        aggrTotalValue: aggr_position_info[2],\n                        aggrPerformance: aggr_performance,\n                        shown_columns: init_shown_columns,\n                        done: true })\n\n    }\n\n    // FIXME: disable these parallel API calls during development due to the API quota limits\n    // getQuoteUrl(ticker) {\n    //     //let alpha_vantage_api_key = process.env.REACT_APP_ALPHA_VANTAGE_API_KEY\n    //     let alpha_vantage_api_key = 'demo' // FIXME: default to demo key and MSFT, not rate-limited \n    //     let url_prefix = 'https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol='\n    //     let url_suffix = '&apikey=' + alpha_vantage_api_key\n    //     return url_prefix + ticker + url_suffix\n    // }\n    // \n    // async getCurrentQuotes(tickers) {\n    //     let newQuotes = {}\n    //     const quotesApiResults = await Promise.all(tickers.map(ticker =>\n    //         fetch(this.getQuoteUrl(ticker))\n    //         .then(res => res.json())\n    //     ))\n    //     quotesApiResults.forEach(function(item, idx) {\n    //         let quoteResult = item['Global Quote']\n    //         let newQuote = {}\n    //         let ticker = quoteResult['01. symbol'] + idx\n    //         newQuote['symbol'] = this.convertNameForIndicies(ticker)\n    //         newQuote['current_price'] = (Math.round(100 * parseFloat(quoteResult['05. price'])) / 100).toFixed(2)\n    //         newQuote['change'] = (Math.round(100 * parseFloat(quoteResult['09. change'])) / 100).toFixed(2)\n    //         newQuote['change_pct'] = (Math.round(100 * parseFloat(quoteResult['10. change percent'].slice(0, -1))) / 100).toFixed(2)\n    //         newQuote['volume'] = parseInt(quoteResult['06. volume'])\n    //         newQuotes[ticker] = newQuote\n    //     })\n    //     this.setState({ allCurrentQuotes: newQuotes })\n    // }\n\n    getTransactionById(transaction_id) {\n        return this.state.allTransactions.filter(transaction => transaction.modified_at === transaction_id)[0]\n    }\n\n    getTransactionsByTicker(ticker) {\n        return this.state.allTransactions.filter(transaction => transaction.ticker === ticker)\n    }\n\n    getPositionFromSingleTickerTransactions(transactions) { // assumes the transactions are all from a single ticker\n        let inflows = 0, outflows = 0, current_shares = 0, date, action, num_shares, ticker, value\n        let sorted_transactions = transactions.sort(function(a,b) {\n            if (a.date > b.date) {\n                return -1\n            } else if (a.date < b.date) {\n                return -1\n            } else {\n                return 0\n            }\n        })\n        let position_start_date = '1970/01/01'\n        sorted_transactions.forEach(function(transaction) {\n            [date, action, num_shares, ticker, value] = transaction.summary.split(' ')\n            date = date.substr(0, date.length-1)\n            num_shares = parseInt(num_shares)\n            value = parseFloat(value.substr(1))\n            if (current_shares === 0) {\n                position_start_date = date\n            }\n            if (action === 'buy') {\n                outflows += value\n                current_shares += num_shares\n            } else if (action === 'sell') {\n                inflows += value\n                current_shares -= num_shares\n            }\n            if (current_shares === 0) {\n                position_start_date = 'n/a'\n            }\n        })\n        let newPosition = {\n            symbol: ticker,\n            current_shares: current_shares,\n            start_date: position_start_date,\n            basis: Math.round((outflows > inflows) ? outflows - inflows : 0),\n            realized_gains: Math.round((inflows > outflows || current_shares === 0) ? inflows - outflows : 0)\n        }\n\n        return newPosition\n    }\n\n    getPositionFromCashTransactions(cash_transactions) {\n        let total = 0, action, value\n\n        cash_transactions.forEach(function(cash_transaction) {\n            [, action, value] = cash_transaction.summary.split(' ')\n            let cash_amount = parseFloat(value.substr(1))\n            if (action === 'transferIN' || action === 'dividend') {\n                total += cash_amount\n            } else if (action === 'transferOUT' || action === 'fee') {\n                total -= cash_amount\n            }\n        })\n        let newPosition = {\n            symbol: 'cash',\n            current_shares: total,\n            basis: total,\n            realized_gains: 0\n        }\n\n        return newPosition\n    }\n\n    calculateAggrPositionInfo(all_tags, all_positions, all_quotes, show_holdings, show_cash) {\n\n        let holdings = (show_holdings === null) ? this.state.show_holdings : show_holdings\n        let cash = (show_cash === null) ? this.state.show_cash : show_cash\n\n        let aggr_totalbasis_by_tag = {}, aggr_totalrealized_by_tag = {}, aggr_totalvalue_by_tag = {}\n        aggr_totalbasis_by_tag['_everything_'] = 0\n        aggr_totalrealized_by_tag['_everything_'] = 0\n        aggr_totalvalue_by_tag['_everything_'] = 0\n        Object.keys(all_tags).forEach(function(tag) {\n            aggr_totalrealized_by_tag[tag] = 'n/a';\n            aggr_totalbasis_by_tag[tag] = 'n/a';\n            aggr_totalvalue_by_tag[tag] = 'n/a';\n            Object.keys(all_positions).forEach(function(ticker) {\n                if (all_tags[tag].includes(ticker)) {\n                    aggr_totalrealized_by_tag[tag] = 0 \n                    aggr_totalbasis_by_tag[tag] = 0 \n                    aggr_totalvalue_by_tag[tag] = 0 \n                }\n            })\n        })\n        Object.entries(all_positions).forEach(function(position_info) {\n            let ticker = position_info[0]\n            let ticker_basis = position_info[1]['basis']\n            let ticker_realized_gains = position_info[1]['realized_gains']\n            let ticker_shares = position_info[1]['current_shares']\n            let ticker_price = all_quotes[ticker]['current_price'] || 1\n            if ((ticker !== 'cash' && holdings) || (ticker === 'cash' && cash)) {\n                aggr_totalbasis_by_tag['_everything_'] += ticker_basis - ticker_realized_gains\n                aggr_totalrealized_by_tag['_everything_'] += ticker_realized_gains\n                aggr_totalvalue_by_tag['_everything_'] += ticker_price * ticker_shares\n                Object.keys(all_tags).forEach(function(tag) {\n                    if (all_tags[tag].includes(ticker)) {\n                        aggr_totalbasis_by_tag[tag] += ticker_basis - ticker_realized_gains\n                        aggr_totalrealized_by_tag[tag] += parseFloat(ticker_realized_gains)\n                        if (aggr_totalbasis_by_tag[tag] < 0) {\n                            aggr_totalbasis_by_tag[tag] = 0\n                        }\n                        aggr_totalvalue_by_tag[tag] += ticker_price * ticker_shares\n                    }\n                })\n            }\n        })\n        if (aggr_totalbasis_by_tag['_everything_'] < 0) {\n            aggr_totalbasis_by_tag['_everything_'] = 0\n        }\n\n        return [aggr_totalbasis_by_tag, aggr_totalrealized_by_tag, aggr_totalvalue_by_tag]\n    }\n\n    calculateAggrPerformance(all_tags, all_performance_numbers) {\n\n        let aggr_performance_by_tag = {}\n        aggr_performance_by_tag['_everything_'] = {\n            short_change_pct: 0,\n            medium_change_pct: 0,\n            long_change_pct: 0,\n            num_tickers: 0\n        }\n\n        let all_stocks_of_interest = []\n        Object.values(all_tags).forEach(function(array_of_tickers) {\n            array_of_tickers.forEach(ticker => all_stocks_of_interest.push(ticker))\n        })\n        all_stocks_of_interest = Array.from(new Set(all_stocks_of_interest))\n\n        all_stocks_of_interest.forEach(function(ticker) {\n\n            let short = all_performance_numbers[ticker]['short_change_pct']\n            let medium = all_performance_numbers[ticker]['medium_change_pct']\n            let long = all_performance_numbers[ticker]['long_change_pct']\n\n            aggr_performance_by_tag['_everything_'].short_change_pct += short\n            aggr_performance_by_tag['_everything_'].medium_change_pct += medium\n            aggr_performance_by_tag['_everything_'].long_change_pct += long\n            aggr_performance_by_tag['_everything_'].num_tickers += 1\n\n            Object.keys(all_tags).forEach(function(tag) {\n                if (aggr_performance_by_tag.hasOwnProperty(tag) && all_tags[tag].includes(ticker)) {\n                    aggr_performance_by_tag[tag].short_change_pct += short\n                    aggr_performance_by_tag[tag].medium_change_pct += medium\n                    aggr_performance_by_tag[tag].long_change_pct += long\n                    aggr_performance_by_tag[tag].num_tickers += 1\n                } else if (all_tags[tag].includes(ticker)) {\n                    let new_aggr_performance = {}\n                    new_aggr_performance['short_change_pct'] = short\n                    new_aggr_performance['medium_change_pct'] = medium\n                    new_aggr_performance['long_change_pct'] = long\n                    new_aggr_performance['num_tickers'] = 1\n                    aggr_performance_by_tag[tag] = new_aggr_performance\n                }\n            })\n        })\n\n        Object.entries(aggr_performance_by_tag).forEach(function(tag_performance) {\n            let tag = tag_performance[0]\n            let performance = tag_performance[1]\n            Object.keys(performance).filter(time_range => time_range !== 'num_tickers').forEach(function(time_range) {\n                let value = (performance['num_tickers']) ? performance[time_range] / performance.num_tickers : 'n/a'\n                aggr_performance_by_tag[tag][time_range] = value\n            })\n        })\n\n        return aggr_performance_by_tag\n    }\n\n    onInputChange(event) {\n        let name = event.target.name\n\n        if (name === 'baseline') {\n            let new_baseline_name = event.target.value\n            let new_baseline = {}\n            new_baseline['name'] = new_baseline_name\n            if (new_baseline_name === 'sp500_pct_gain') {\n                new_baseline['short_change_pct'] = this.state.allPerformanceNumbers['S&P500']['short_change_pct']\n                new_baseline['medium_change_pct'] = this.state.allPerformanceNumbers['S&P500']['medium_change_pct']\n                new_baseline['long_change_pct'] = this.state.allPerformanceNumbers['S&P500']['long_change_pct']\n            } else {\n                new_baseline['short_change_pct'] = 0\n                new_baseline['medium_change_pct'] = 0\n                new_baseline['long_change_pct'] = 0\n            }\n\n            localStorage.setItem('baseline', JSON.stringify(new_baseline))\n            this.setState({ baseline: new_baseline })\n        }\n    }\n    \n    onShowInputChange(event) {\n        const target = event.target\n        const new_value = target.type === 'checkbox' ? target.checked : target.value\n        const name = target.name\n        localStorage.setItem(name, JSON.stringify(new_value))\n\n        // recalculate the aggregate numbers\n        let show_cash = (name === 'show_cash') ? new_value : this.state.show_cash\n        let show_holdings = (name === 'show_holdings') ? new_value : this.state.show_holdings\n        let aggr_position_info = JSON.parse(JSON.stringify(\n            this.calculateAggrPositionInfo(\n                this.state.allTags, \n                this.state.allPositions, \n                this.state.allCurrentQuotes, \n                show_holdings,\n                show_cash)))\n\n        if (name === 'show_cash') {\n            this.onWhatifGo(this.state.balance_target_set, this.state.sell_all_of, this.state.balance_target_column, new_value, this.state.remaining_cash)\n        }\n\n        this.setState({ \n            [name]: new_value,\n            aggrBasis: aggr_position_info[0],\n            aggrRealized: aggr_position_info[1],\n            aggrTotalValue: aggr_position_info[2],\n        })\n    }\n\n    onChangeWhatifFormat() {\n        let new_whatif_format = (this.state.whatif_format === 'deltas') ? 'new_values' : 'deltas'\n        localStorage.setItem('whatif_format', JSON.stringify(new_whatif_format))\n        this.setState({ whatif_format: new_whatif_format })\n    }\n\n    onChangeSort(new_sort_column) {\n        if (new_sort_column === this.state.sort_column) {\n            localStorage.setItem('sort_dir_asc', JSON.stringify(!this.state.sort_dir_asc))\n            this.setState(prevState => ({\n                sort_dir_asc: !prevState.sort_dir_asc\n            }))\n        }\n        localStorage.setItem('sort_column', JSON.stringify(new_sort_column))\n        this.setState({ sort_column: new_sort_column })\n    }\n\n    showColumns(column_names) {\n        this.setState(prevState => {\n            let new_shown_column_names = JSON.parse(JSON.stringify(prevState.shown_columns)).map(column => column.name)\n            column_names.forEach(function(column_name) {\n                if (!new_shown_column_names.includes(column_name)) {\n                    new_shown_column_names.push(column_name)\n                }\n            })\n            let new_shown_columns = all_columns.filter(column => new_shown_column_names.includes(column.name))\n            localStorage.setItem('shown_columns', JSON.stringify(new_shown_columns))\n            return { shown_columns: new_shown_columns }\n        })\n    }\n\n    onToggleShowColumn(column_name) {\n        this.setState(prevState => {\n            let new_shown_column_names = JSON.parse(JSON.stringify(prevState.shown_columns)).map(column => column.name)\n            if (new_shown_column_names.includes(column_name)) {\n                new_shown_column_names.splice(new_shown_column_names.findIndex(name => name === column_name), 1)\n            } else {\n                new_shown_column_names.push(column_name)\n            }\n            let new_shown_columns = all_columns.filter(column => new_shown_column_names.includes(column.name))\n            localStorage.setItem('shown_columns', JSON.stringify(new_shown_columns))\n            return { shown_columns: new_shown_columns }\n        })\n    }\n\n    tickerIsIndex(ticker) {\n        return (this.state.allIndiciesTickers.includes(ticker) || this.state.allIndiciesAliases.includes(ticker)) ? true : false\n    }\n\n    convertNameForIndicies(ticker) {\n        let idx = this.state.allIndiciesTickers.indexOf(ticker)\n        if (idx !== -1) {\n            return this.state.allIndiciesAliases[idx]\n        } else {\n            return ticker\n        }\n    }\n\n    createMessage(message_content) {\n        let new_message = {\n            modified_at: new Date().getTime(),\n            content: message_content\n        }\n        return new_message\n    }\n\n    onNewTags(new_tags) {\n        this.setState(prevState => {\n\n            // update tag membership info\n            let newAllTags = JSON.parse(JSON.stringify(prevState.allTags))\n            new_tags.forEach(function(tag) {\n                let newTag = []\n                if (!newAllTags.hasOwnProperty(tag)) {\n                    newAllTags[tag] = newTag\n                }\n            })\n            localStorage.setItem('allTags', JSON.stringify(newAllTags))\n\n            // recalculate the aggregate numbers\n            let aggr_position_info = JSON.parse(JSON.stringify(\n                this.calculateAggrPositionInfo(\n                    newAllTags, \n                    this.state.allPositions, \n                    this.state.allCurrentQuotes, \n                    this.state.show_holdings,\n                    this.state.show_cash)))\n            let aggr_performance = JSON.parse(JSON.stringify(\n                this.calculateAggrPerformance(\n                    newAllTags, \n                    this.state.allPerformanceNumbers)))\n\n            return { \n                allTags: newAllTags,\n                aggrBasis: aggr_position_info[0],\n                aggrRealized: aggr_position_info[1],\n                aggrTotalValue: aggr_position_info[2],\n                aggrPerformance: aggr_performance,\n            }\n        })\n    }\n\n    onNewTickers(tag, new_tickers) {\n        this.setState(prevState => {\n\n            // update tag membership info\n            let newAllTags = JSON.parse(JSON.stringify(prevState.allTags))\n            new_tickers.forEach(function(ticker) {\n                if (!newAllTags[tag].includes(ticker)) {\n                    newAllTags[tag].push(ticker)\n                    if (tag !== 'untagged') {\n                        newAllTags['untagged'] = newAllTags['untagged'].filter(untagged_ticker => untagged_ticker !== ticker)\n                    }\n                }\n            })\n            localStorage.setItem('allTags', JSON.stringify(newAllTags))\n\n            // recalculate the aggregate numbers\n            let aggr_position_info = JSON.parse(JSON.stringify(\n                this.calculateAggrPositionInfo(\n                    newAllTags, \n                    this.state.allPositions, \n                    this.state.allCurrentQuotes, \n                    this.state.show_holdings,\n                    this.state.show_cash)))\n            let aggr_performance = JSON.parse(JSON.stringify(\n                this.calculateAggrPerformance(\n                    newAllTags, \n                    this.state.allPerformanceNumbers)))\n\n            return { \n                allTags: newAllTags,\n                aggrBasis: aggr_position_info[0],\n                aggrRealized: aggr_position_info[1],\n                aggrTotalValue: aggr_position_info[2],\n                aggrPerformance: aggr_performance,\n            }\n        })\n    }\n\n    onDeleteTicker(delete_ticker) {\n        this.setState(prevState => {\n\n            // update tag membership info\n            let newAllTags = JSON.parse(JSON.stringify(prevState.allTags))\n            let all_tags_for_this_ticker = []\n            Object.keys(newAllTags).forEach(function(tag_name) {\n                all_tags_for_this_ticker.push(tag_name)\n            })\n            all_tags_for_this_ticker.forEach(function(tag) {\n                newAllTags[tag] = newAllTags[tag].filter(ticker => ticker !== delete_ticker)\n            })\n            localStorage.setItem('allTags', JSON.stringify(newAllTags))\n\n            // update position\n            let newAllPositions = JSON.parse(JSON.stringify(prevState.allPositions))\n            delete newAllPositions[delete_ticker]\n\n            // update transactions\n            let newAllTransactions = JSON.parse(JSON.stringify(prevState.allTransactions)).filter(transaction => transaction.ticker !== delete_ticker)\n            localStorage.setItem('allTransactions', JSON.stringify(newAllTransactions))\n\n            // add status messages\n            let newAllStatusMessages = [...prevState.all_status_messages]\n            let new_messages = []\n            new_messages.push(this.createMessage('Ticker \"' + delete_ticker + '\" has now been deleted.'))\n            let newLastErrorMessages = new_messages.filter( message_obj => message_obj.content.includes('ERROR'))\n            newAllStatusMessages = [...new_messages, ...newAllStatusMessages]\n\n            // recalculate the aggregate numbers\n            let aggr_position_info = JSON.parse(JSON.stringify(\n                this.calculateAggrPositionInfo(\n                    newAllTags, \n                    newAllPositions, \n                    this.state.allCurrentQuotes, \n                    this.state.show_holdings,\n                    this.state.show_cash)))\n            let aggr_performance = JSON.parse(JSON.stringify(\n                this.calculateAggrPerformance(\n                    newAllTags, \n                    this.state.allPerformanceNumbers)))\n\n            return { \n                allTags: newAllTags, \n                allPositions: newAllPositions, \n                allTransactions: newAllTransactions, \n                all_status_messages: newAllStatusMessages,\n                last_error_messages: newLastErrorMessages,\n                aggrBasis: aggr_position_info[0],\n                aggrRealized: aggr_position_info[1],\n                aggrTotalValue: aggr_position_info[2],\n                aggrPerformance: aggr_performance,\n            }\n        })\n    }\n\n    onNewTransaction(new_transaction_summary) {\n        let date, action, num_shares, ticker, total\n        [date, action, num_shares, ticker, total]  = new_transaction_summary.split(' ')\n        date = date.substr(0, date.length-1)\n        num_shares = parseInt(num_shares)\n        total = parseFloat(total.substr(1))\n        this.setState(prevState => {\n\n            // update tag membership info only if this is a new ticker\n            let newAllTags = JSON.parse(JSON.stringify(prevState.allTags))\n            if (!(this.getAdded().includes(ticker))){\n                newAllTags['untagged'].push(ticker)\n            }\n            localStorage.setItem('allTags', JSON.stringify(newAllTags))\n\n            // update transaction info\n            let newAllTransactions = JSON.parse(JSON.stringify(prevState.allTransactions))\n            let new_transaction = { \n                modified_at: new Date().getTime(),\n                date: date,\n                ticker: ticker,\n                action: action,\n                shares: num_shares,\n                total: total,\n                summary: new_transaction_summary\n            }\n            newAllTransactions.push(new_transaction)\n            localStorage.setItem('allTransactions', JSON.stringify(newAllTransactions))\n\n            // recalculate the position numbers\n            let orig_start_date, orig_basis = 0, orig_current_shares = 0, orig_realized_gains = 0\n            let newAllPositions = JSON.parse(JSON.stringify(prevState.allPositions))\n            if (newAllPositions.hasOwnProperty(ticker) && newAllPositions[ticker] !== null) {\n                orig_start_date = newAllPositions[ticker]['start_date']\n                orig_basis = newAllPositions[ticker]['basis']\n                orig_current_shares = newAllPositions[ticker]['current_shares']\n                orig_realized_gains = newAllPositions[ticker]['realized_gains']\n            }\n            let new_current_shares = (action === 'buy') ? orig_current_shares + num_shares : orig_current_shares - num_shares\n            let new_start_date\n            if (orig_start_date === undefined) {\n                new_start_date = date\n            } else {\n                new_start_date = (new Date(date) < new Date(orig_start_date)) ? date : orig_start_date\n            }\n            let updatedPosition = {\n                current_shares: new_current_shares,\n                start_date: (new_current_shares) ? new_start_date : 'n/a',\n                symbol: ticker,\n                basis: (action === 'buy') ? orig_basis + total : orig_basis - total,\n                realized_gains: (action === 'sell') ? orig_realized_gains + total : orig_realized_gains\n            }\n            if (updatedPosition['basis'] < 0) {\n                updatedPosition['basis'] = 0\n            }\n            newAllPositions[ticker] = updatedPosition\n\n            // recalculate the cash position numbers\n            orig_current_shares = (newAllPositions.hasOwnProperty('cash')) ? newAllPositions['cash'].current_shares : 0\n            new_current_shares = (action === 'buy') ? orig_current_shares - total : orig_current_shares + total\n            let updatedCashPosition = {\n                current_shares: new_current_shares,\n                symbol: 'cash',\n                basis: new_current_shares,\n                realized_gains: 0\n            }\n            newAllPositions['cash'] = updatedCashPosition\n\n            // recalculate the aggregate numbers\n            let aggr_position_info = JSON.parse(JSON.stringify(\n                this.calculateAggrPositionInfo(\n                    newAllTags,\n                    newAllPositions,\n                    this.state.allCurrentQuotes, \n                    this.state.show_holdings,\n                    this.state.show_cash)))\n            let aggr_performance = JSON.parse(JSON.stringify(\n                this.calculateAggrPerformance(\n                    newAllTags,\n                    this.state.allPerformanceNumbers)))\n\n            return { \n                allTags: newAllTags, \n                allTransactions: newAllTransactions, \n                allPositions: newAllPositions, \n                aggrBasis: aggr_position_info[0],\n                aggrRealized: aggr_position_info[1],\n                aggrTotalValue: aggr_position_info[2],\n                aggrPerformance: aggr_performance,\n            }\n        })\n    }\n\n    onImportTransactions(file_contents) {\n\n        let imported_tickers = []\n\n        let imported_transactions = JSON.parse(JSON.stringify(file_contents.transactions))\n        imported_transactions.forEach( transaction => imported_tickers.push(transaction.ticker) )\n\n        let imported_risk = JSON.parse(JSON.stringify(file_contents.risk))\n        Object.keys(imported_risk).forEach( ticker => imported_tickers.push(ticker))\n\n        let all_stocks_of_interest = Array.from(new Set(imported_tickers))\n        this.setState(prevState => {\n\n            // update the \"untagged\" tag so that all added tickers belong to a tag\n            let newAllTags = JSON.parse(JSON.stringify(prevState.allTags))\n            let already_added = []\n            Object.keys(newAllTags).forEach(function(tag) {\n                newAllTags[tag].forEach(function(ticker) {\n                    if (!already_added.includes(ticker)) {\n                        already_added.push(ticker)\n                    }\n                })\n            })\n            all_stocks_of_interest.forEach( function(ticker) {\n                if (!already_added.includes(ticker) && ticker !== 'cash') {\n                    newAllTags['untagged'].push(ticker)\n                }\n            })\n            localStorage.setItem('allTags', JSON.stringify(newAllTags))\n\n            // replace the stored transactions\n            localStorage.setItem('allTransactions', JSON.stringify(imported_transactions))\n\n            // replace the stored risk\n            localStorage.setItem('allRisk', JSON.stringify(imported_risk))\n\n            return\n        })\n\n        window.location.reload(false)\n    }\n\n    onNewCash(new_cash_transaction_summary) {\n        let date, action, total\n        [date, action, total]  = new_cash_transaction_summary.split(' ')\n        date = date.substr(0, date.length-1)\n        total = parseFloat(total.substr(1))\n        this.setState(prevState => {\n\n            // update transaction info\n            let newAllTransactions = JSON.parse(JSON.stringify(prevState.allTransactions))\n            let new_cash_transaction = { \n                modified_at: new Date().getTime(),\n                date: date,\n                ticker: 'cash',\n                action: action,\n                shares: total,\n                total: total,\n                summary: new_cash_transaction_summary\n            }\n            newAllTransactions.push(new_cash_transaction)\n            localStorage.setItem('allTransactions', JSON.stringify(newAllTransactions))\n\n            // recalculate the position numbers\n            let newAllPositions = JSON.parse(JSON.stringify(prevState.allPositions))\n            let orig_current_shares = 0\n            if (newAllPositions.hasOwnProperty('cash')) {\n                orig_current_shares = newAllPositions['cash']['current_shares']\n            }\n            let new_cash = (action === 'add') ? orig_current_shares + total : orig_current_shares - total\n            let updatedPosition = {\n                symbol: 'cash',\n                basis: (new_cash >= 0) ? new_cash : 0,\n                current_shares: new_cash,\n                realized_gains: 0\n            }\n            newAllPositions['cash'] = updatedPosition\n\n            // recalculate the aggregate numbers\n            let aggr_position_info = JSON.parse(JSON.stringify(\n                this.calculateAggrPositionInfo(\n                    this.state.allTags, \n                    newAllPositions,\n                    this.state.allCurrentQuotes, \n                    this.state.show_holdings,\n                    this.state.show_cash)))\n            let aggr_performance = JSON.parse(JSON.stringify(\n                this.calculateAggrPerformance(\n                    this.state.allTags, \n                    this.state.allPerformanceNumbers)))\n\n            return { \n                allTransactions: newAllTransactions, \n                allPositions: newAllPositions, \n                aggrBasis: aggr_position_info[0],\n                aggrRealized: aggr_position_info[1],\n                aggrTotalValue: aggr_position_info[2],\n                aggrPerformance: aggr_performance,\n            }\n        })\n    }\n\n    onDeleteTransaction(delete_transaction_id) {\n\n        let transaction_to_delete = this.getTransactionById(delete_transaction_id)\n        let ticker = transaction_to_delete.ticker\n\n        this.setState(prevState => {\n\n            // update transactions\n            let newAllTransactions = JSON.parse(JSON.stringify(prevState.allTransactions)).filter(transaction => transaction.modified_at !== delete_transaction_id)\n            localStorage.setItem('allTransactions', JSON.stringify(newAllTransactions))\n\n            // add status messages\n            let newAllStatusMessages = [...prevState.all_status_messages]\n            let new_messages = []\n            new_messages.push(this.createMessage('Transaction \"' + transaction_to_delete.summary + '\" has now been deleted.'))\n            let newLastErrorMessages = new_messages.filter( message_obj => message_obj.content.includes('ERROR'))\n            newAllStatusMessages = [...new_messages, ...newAllStatusMessages]\n\n            // recalculate the position numbers\n            let remainingTransactionsForTicker = newAllTransactions.filter(transaction => transaction.ticker === ticker)\n            let newAllPositions = JSON.parse(JSON.stringify(prevState.allPositions))\n            let updatedPosition\n            if (!remainingTransactionsForTicker.length) {\n                delete newAllPositions[ticker]\n            } else {\n                if (ticker === 'cash') {\n                    updatedPosition = this.getPositionFromCashTransactions(remainingTransactionsForTicker)\n                } else {\n                    updatedPosition = this.getPositionFromSingleTickerTransactions(remainingTransactionsForTicker)\n                }\n                newAllPositions[ticker] = updatedPosition\n            }\n\n            // recalculate the aggregate numbers\n            let aggr_position_info = JSON.parse(JSON.stringify(\n                this.calculateAggrPositionInfo(\n                    this.state.allTags,\n                    newAllPositions,\n                    this.state.allCurrentQuotes, \n                    this.state.show_holdings,\n                    this.state.show_cash)))\n\n            return { \n                allPositions: newAllPositions, \n                allTransactions: newAllTransactions, \n                all_status_messages: newAllStatusMessages,\n                last_error_messages: newLastErrorMessages,\n                aggrBasis: aggr_position_info[0],\n                aggrRealized: aggr_position_info[1],\n                aggrTotalValue: aggr_position_info[2],\n            }\n        })\n    }\n\n    onRemoveFromTag(remove_from_tag, remove_ticker) {\n        this.setState(prevState => {\n            let newAllTags = JSON.parse(JSON.stringify(prevState.allTags))\n            newAllTags[remove_from_tag] = newAllTags[remove_from_tag].filter(ticker => ticker !== remove_ticker)\n\n            // assign ticker to \"untagged\" if it is losing its last (user) tag\n            let all_other_tags_for_this_ticker = []\n            Object.keys(newAllTags).forEach(function(tag_name) {\n                if (tag_name !== remove_from_tag && tag_name !== 'untagged' && newAllTags[tag_name].includes(remove_ticker)) {\n                    all_other_tags_for_this_ticker.push(tag_name)\n                }\n            })\n            if (!all_other_tags_for_this_ticker.length) {\n                let newUntagged = newAllTags['untagged']\n                newUntagged.push(remove_ticker)\n                newAllTags['untagged'] = newUntagged\n            }\n            localStorage.setItem('allTags', JSON.stringify(newAllTags))\n\n            // recalculate the aggregate numbers\n            let aggr_position_info = JSON.parse(JSON.stringify(\n                this.calculateAggrPositionInfo(\n                    newAllTags, \n                    this.state.allPositions, \n                    this.state.allCurrentQuotes, \n                    this.state.show_holdings,\n                    this.state.show_cash)))\n            let aggr_performance = JSON.parse(JSON.stringify(\n                this.calculateAggrPerformance(\n                    newAllTags, \n                    this.state.allPerformanceNumbers)))\n\n            return { \n                allTags: newAllTags,\n                aggrBasis: aggr_position_info[0],\n                aggrRealized: aggr_position_info[1],\n                aggrTotalValue: aggr_position_info[2],\n                aggrPerformance: aggr_performance,\n            }\n        })\n    }\n\n    onDeleteTag(delete_tag) {\n        this.setState(prevState => {\n\n            let newAllTags = JSON.parse(JSON.stringify(prevState.allTags))\n            let tickers_losing_a_tag = newAllTags[delete_tag]\n            delete newAllTags[delete_tag]\n\n            // assign tickers to \"untagged\" if they are losing their last (user) tag\n            let all_other_tagged_tickers = []\n            Object.keys(newAllTags).forEach(function(tag_name) {\n                if (tag_name !== 'untagged') {\n                    all_other_tagged_tickers = all_other_tagged_tickers.concat(newAllTags[tag_name])\n                }\n            })\n            tickers_losing_a_tag.forEach(function(ticker) {\n                let newUntagged = newAllTags['untagged']\n                if (!all_other_tagged_tickers.includes(ticker)) {\n                    newUntagged.push(ticker)\n                    newAllTags['untagged'] = newUntagged\n                }\n            })\n            localStorage.setItem('allTags', JSON.stringify(newAllTags))\n\n            // add status messages\n            let newAllStatusMessages = [...prevState.all_status_messages]\n            let new_messages = []\n            new_messages.push(this.createMessage('Tag \"' + delete_tag + '\" has now been deleted.'))\n            let newLastErrorMessages = new_messages.filter( message_obj => message_obj.content.includes('ERROR'))\n            newAllStatusMessages = [...new_messages, ...newAllStatusMessages]\n\n            // recalculate the aggregate numbers\n            let aggr_position_info = JSON.parse(JSON.stringify(\n                this.calculateAggrPositionInfo(\n                    newAllTags, \n                    this.state.allPositions, \n                    this.state.allCurrentQuotes, \n                    this.state.show_holdings,\n                    this.state.show_cash)))\n            let aggr_performance = JSON.parse(JSON.stringify(\n                this.calculateAggrPerformance(\n                    newAllTags, \n                    this.state.allPerformanceNumbers)))\n\n            return { \n                allTags: newAllTags, \n                all_status_messages: newAllStatusMessages,\n                last_error_messages: newLastErrorMessages,\n                aggrBasis: aggr_position_info[0],\n                aggrRealized: aggr_position_info[1],\n                aggrTotalValue: aggr_position_info[2],\n                aggrPerformance: aggr_performance,\n            }\n        })\n    }\n\n    onEditCell(row_name) {\n        this.setState(prevState => {\n            if (\n                prevState.editing_row !== row_name\n                && row_name !== this.props.editing_row\n                && !this.nameIsAnAggregate(row_name)\n                && !this.nameIsSpecial(row_name)\n            ) {\n                return { editing_row: row_name }\n            } else {\n                return\n            }\n        })\n    }\n\n    onModifyRiskFactor(ticker, new_value) {\n        this.setState(prevState => {\n\n            let newAllRisk = JSON.parse(JSON.stringify(prevState.allRisk))\n            if (newAllRisk.hasOwnProperty(ticker)) {\n                newAllRisk[ticker]['factor'] = parseFloat(new_value)\n                newAllRisk[ticker]['modified_at'] = new Date().getTime()\n            } else {\n                let newRisk = { \n                    modified_at: new Date().getTime(),\n                    factor: parseFloat(new_value) \n                }\n                newAllRisk[ticker] = newRisk\n            }\n            localStorage.setItem('allRisk', JSON.stringify(newAllRisk))\n\n            return { \n                allRisk: newAllRisk,\n                editing_row: null\n            }\n        })\n    }\n\n    onEscapeKey() {\n        this.setState({ editing_row: null })\n    }\n\n    onNewMessages(new_messages) {\n        this.setState(prevState => {\n            let newAllStatusMessages = [...prevState.all_status_messages]\n            newAllStatusMessages = [...new_messages.reverse(), ...newAllStatusMessages]\n            let newLastErrorMessages = new_messages.filter(message_obj => message_obj.content.includes('ERROR')).reverse()\n            return { \n                last_error_messages: newLastErrorMessages,\n                all_status_messages: newAllStatusMessages }\n        })\n    }\n\n    getCurrentValue(ticker) {\n        if (this.state.allPositions.hasOwnProperty(ticker)) {\n            return this.state.allCurrentQuotes[ticker].current_price * this.state.allPositions[ticker].current_shares\n        } else {\n            return 0\n        }\n    }\n\n    getCurrentShares(ticker) {\n        if (this.state.allPositions.hasOwnProperty(ticker)) {\n            return this.state.allPositions[ticker].current_shares\n        } else {\n            return 0\n        }\n    }\n\n    getBasis(ticker) {\n        if (this.state.allPositions.hasOwnProperty(ticker)) {\n            return this.state.allPositions[ticker].basis\n        } else {\n            return 0\n        }\n    }\n\n    getBalanceableValue(balance_target_set, balance_target_column) {\n\n        let self = this\n        let balanceable_value = 0\n\n        let current_cash_position = 0\n        if (this.state.show_cash && this.state.allPositions.hasOwnProperty('cash')) {\n            current_cash_position = self.state.allPositions['cash'].current_shares * self.state.allCurrentQuotes['cash'].current_price\n        }\n        balanceable_value += current_cash_position\n\n        if (balance_target_set === 'my_holdings') {\n            if (this.state.show_holdings) {\n                Object.keys(this.state.allPositions).filter( ticker => ticker !== 'cash' ).forEach( function(ticker) {\n                    let current_value = self.state.allPositions[ticker].current_shares * self.state.allCurrentQuotes[ticker].current_price\n                    if (balance_target_column === 'current_value' || 'value_at_risk' || 'only_profits') {\n                        balanceable_value += current_value\n                    } else if (balance_target_column === 'basis' || 'basis_risked') {\n                        balanceable_value += self.state.allPositions[ticker].basis\n                    }\n                })\n            }\n        } else if (balance_target_set === 'untagged') {\n            if (this.state.show_untagged && this.state.allTags.hasOwnProperty('untagged')) {\n                this.state.allTags['untagged'].filter( ticker => self.state.allPositions.hasOwnProperty(ticker) ).forEach( function(ticker) {\n                    let current_value = self.state.allPositions[ticker].current_shares * self.state.allCurrentQuotes[ticker].current_price\n                    if (balance_target_column === 'current_value' || 'value_at_risk' || 'only_profits') {\n                        balanceable_value += current_value\n                    } else if (balance_target_column === 'basis' || 'basis_risked') {\n                        balanceable_value += self.state.allPositions[ticker].basis\n                    }\n                })\n            }\n        } else { // balance_target_set is a tag name\n            if (this.state.show_tagged) {\n                this.state.allTags[balance_target_set].filter( ticker => self.state.allPositions.hasOwnProperty(ticker) ).forEach( function(ticker) {\n                    let current_value = self.state.allPositions[ticker].current_shares * self.state.allCurrentQuotes[ticker].current_price\n                    if (balance_target_column === 'current_value' || 'value_at_risk' || 'only_profits') {\n                        balanceable_value += current_value\n                    } else if (balance_target_column === 'basis' || 'basis_risked') {\n                        balanceable_value += self.state.allPositions[ticker].basis\n                    }\n                })\n            }\n        }\n\n        return balanceable_value\n    }\n\n    onWhatifSubmit(balance_target_set, sell_all_of, balance_target_column, remaining_cash) {\n        this.setState({ \n            remaining_cash: remaining_cash, \n            balance_target_set: balance_target_set, \n            sell_all_of: sell_all_of,\n            balance_target_column: balance_target_column \n            })\n        let column = balance_target_column\n        if (balance_target_column === 'only_profits') {\n            column = 'basis'\n        }\n        let show_whatif_columns = ['current_shares', 'whatif_current_shares', column, 'whatif_'+column]\n        if (balance_target_column.includes('risk')) {\n            show_whatif_columns.push('risk_factor')\n        }\n        this.showColumns(show_whatif_columns)\n        this.onWhatifGo(balance_target_set, sell_all_of, balance_target_column, this.state.show_cash, remaining_cash)\n    }\n\n    onWhatifGo(balance_target_set, sell_all_set, balance_target_column, show_cash, remaining_cash) {\n\n        let self = this\n        let adjusting_cash = show_cash && remaining_cash !== null\n        let original_cash_position = (this.state.allPositions.hasOwnProperty('cash')) ? this.state.allPositions['cash'].current_shares * this.state.allCurrentQuotes['cash'].current_price : 0\n\n        // determine the total value to be balanced\n        let total_balance_value = this.getBalanceableValue(balance_target_set, balance_target_column) // includes cash if show_cash is enabled\n        if (remaining_cash === null) {\n            total_balance_value -= original_cash_position\n        } else {\n            total_balance_value -= remaining_cash\n        }\n\n        // determine the tickers to balance across\n        let ticker_set = []\n        if (balance_target_set === 'my_holdings') {\n            ticker_set = [...this.getHoldings().filter( ticker => ticker !== 'cash' )]\n        } else if (balance_target_set === 'untagged') {\n            ticker_set = [...this.getUntagged()]\n        } else {\n            ticker_set = this.state.allTags[balance_target_set]\n        }\n\n        // determine these tickers' what-if values for each relevant column\n        let new_whatif = {\n            balance_target_column: balance_target_column,\n            values: {}\n        }\n\n        let actual_remaining_cash = original_cash_position\n        let risk_factors = {}\n        ticker_set.forEach(function(ticker) {\n            if (self.state.allRisk.hasOwnProperty(ticker)){\n                risk_factors[ticker] = self.state.allRisk[ticker].factor\n            } else {\n                risk_factors[ticker] = 0.20\n            }\n        })\n        ticker_set.forEach(function(ticker) {\n\n            let whatif_currentshares, whatif_balancedvalue\n            \n            let target = total_balance_value / ticker_set.length\n            new_whatif.values[ticker] = {}\n\n            if (sell_all_set.includes(ticker)) {\n                new_whatif.values[ticker]['current_shares'] = 0\n                new_whatif.values[ticker]['basis'] = 'n/a'\n                new_whatif.values[ticker]['basis_risked'] = 'n/a'\n                new_whatif.values[ticker]['current_value'] = 0\n                new_whatif.values[ticker]['value_at_risk'] = 'n/a'\n                return\n            }\n\n            let value_delta = 0\n            let original_currentvalue = self.getCurrentValue(ticker)\n            let original_basis = self.getBasis(ticker)\n\n            if (sell_all_set.includes(ticker)) {\n                new_whatif.values[ticker]['current_shares'] = 0\n                new_whatif.values[ticker]['current_value'] = 0\n                new_whatif.values[ticker]['basis'] = 0\n                new_whatif.values[ticker]['basis_risked'] = 0\n                new_whatif.values[ticker]['value_at_risk'] = 0\n                return\n            }\n\n            // balancing by value is a simple average of current values\n            if (balance_target_column === 'current_value') {\n\n                whatif_currentshares = Math.floor(target / self.state.allCurrentQuotes[ticker].current_price)\n                new_whatif.values[ticker]['current_shares'] = whatif_currentshares\n\n                whatif_balancedvalue = whatif_currentshares * self.state.allCurrentQuotes[ticker].current_price\n                new_whatif.values[ticker]['current_value'] = whatif_balancedvalue\n\n                value_delta = whatif_balancedvalue - original_currentvalue\n                let whatif_basis = original_basis + value_delta\n                if (whatif_basis < 0) {\n                    whatif_basis = 0\n                }\n                new_whatif.values[ticker]['basis'] = whatif_basis\n                new_whatif.values[ticker]['basis_risked'] = whatif_basis * risk_factors[ticker]\n\n                new_whatif.values[ticker]['value_at_risk'] = whatif_balancedvalue * risk_factors[ticker]\n\n            // balancing by basis must account for sunk costs too; current value is not enough\n            } else if (balance_target_column === 'basis') {\n\n                let original_currentshares = self.getCurrentShares(ticker)\n                let target_delta = target - original_basis\n                let target_delta_shares\n                if (target_delta >= 0) {\n                    target_delta_shares = Math.floor(target_delta / self.state.allCurrentQuotes[ticker].current_price)\n                } else {\n                    target_delta_shares = Math.ceil(target_delta / self.state.allCurrentQuotes[ticker].current_price)\n                }\n                whatif_currentshares = original_currentshares + target_delta_shares\n                new_whatif.values[ticker]['current_shares'] = whatif_currentshares\n\n                let whatif_balancedbasis = original_basis + target_delta_shares * self.state.allCurrentQuotes[ticker].current_price\n                if (whatif_balancedbasis < 0) {\n                    whatif_balancedbasis = 0\n                }\n                new_whatif.values[ticker]['basis'] = whatif_balancedbasis\n                new_whatif.values[ticker]['basis_risked'] = whatif_balancedbasis * risk_factors[ticker]\n\n                value_delta = whatif_balancedbasis - original_basis\n                new_whatif.values[ticker]['current_value'] = original_currentvalue + value_delta\n\n                new_whatif.values[ticker]['value_at_risk'] = new_whatif.values[ticker]['current_value'] * risk_factors[ticker]\n\n            } else if (balance_target_column === 'only_profits') {\n\n                let original_currentshares = self.getCurrentShares(ticker)\n                let original_currentvalue = original_currentshares * self.state.allCurrentQuotes[ticker].current_price\n                let target_delta_shares\n                let losing = (original_basis > original_currentvalue) ? true : false\n                if (losing) {\n                    new_whatif.values[ticker]['current_shares'] = 0\n                } else {\n                    let target_delta = original_basis\n                    target_delta_shares = -1 * Math.ceil(target_delta / self.state.allCurrentQuotes[ticker].current_price)\n                    whatif_currentshares = original_currentshares + target_delta_shares\n                    new_whatif.values[ticker]['current_shares'] = whatif_currentshares\n                }\n\n                let whatif_basis = original_basis + target_delta_shares * self.state.allCurrentQuotes[ticker].current_price\n                if (whatif_basis < 0) {\n                    whatif_basis = 0\n                }\n                if (losing || sell_all_set.includes(ticker)) {\n                    new_whatif.values[ticker]['basis'] = 'n/a'\n                    new_whatif.values[ticker]['basis_risked'] = 'n/a'\n                    new_whatif.values[ticker]['current_value'] = 0\n                    new_whatif.values[ticker]['value_at_risk'] = 'n/a'\n                } else {\n                    new_whatif.values[ticker]['basis'] = whatif_basis\n                    new_whatif.values[ticker]['basis_risked'] = whatif_basis * risk_factors[ticker]\n\n                    value_delta = whatif_basis - original_basis\n                    new_whatif.values[ticker]['current_value'] = original_currentvalue + value_delta\n\n                    new_whatif.values[ticker]['value_at_risk'] = new_whatif.values[ticker]['current_value'] * risk_factors[ticker]\n                }\n            }\n\n            if (adjusting_cash) {\n                actual_remaining_cash -= value_delta \n            }\n        })\n\n        // RISK BALANCING ALGORITHM:\n        //\n        // given:\n        //   3 positions (tickers)\n        //   ticker risk factors a, b, c \n        //   and total portfolio value Vtot \n        //\n        // need to solve for:\n        //   ticker position values V1, V2, V3 \n        //\n        // total portfolio value is the sum of each position:\n        //   V1 + V2 + V3 = Vtot\n        //\n        // for balanced risk, each weighted position must be equal:\n        //   aV1 + bV2 + cV3 = TotalRisk, where aV1 = bV2 = cV3\n        // \n        // solving the first equation for V1 using substitution:\n        //   V1 = (Vtot * bc) / (bc + ac + ab)      <== \"numerator\" / \"denominator\"\n        //\n        // extending this for 4 and 5 positions:\n        //   4 positions... V1 = (Vtot * bcd) / (bcd + acd + abd + abc)\n        //   5 positions... V1 = (Vtot * bcde) / (bcde + acde + abde + abce + abcd)\n        //\n        // then solve for the other ticker positions:\n        //   V2 = aV1/b, V3 = aV1/c, V4 = aV1/d, V5=aV1/e\n        //\n        // The above applies to risk-balancing VALUE. This results in each position currently\n        // having the same dollar value at risk right now. Similarly, in order to risk-balance \n        // by BASIS, the same formula may be used except with Btot (total basis) in the numerator.\n        // This results in each position having the same amount of sunk investment dollars at risk,\n        // it is unaffected by each position's current stock price.\n\n        // balancing by risk requires a complicated algorithm (shown above)\n        if (balance_target_column === 'value_at_risk' || balance_target_column === 'basis_risked') {\n            \n            // determine the numerator\n            let numerator_product = 1\n            ticker_set.forEach(function(ticker, idx) {\n                if (idx !== 0) {\n                    numerator_product *= risk_factors[ticker]\n                }\n            })\n            let numerator = total_balance_value * numerator_product\n\n            // determine the denominator\n            let denominator_terms = Array(ticker_set.length).fill(1)\n            ticker_set.forEach(function(ticker, ticker_idx) {\n                denominator_terms.forEach(function(term, term_idx) {\n                    if (ticker_idx !== term_idx) {\n                        denominator_terms[term_idx] = term * risk_factors[ticker]\n                    }\n                })\n            })\n            let denominator = denominator_terms.reduce( (accumulator, currentValue) => accumulator + currentValue, 0 )\n\n            // determine the target value for each ticker; each will be different if their risk factors are different\n            let targets = Array(ticker_set.length).fill(0)\n            targets[0] = numerator / denominator\n            ticker_set.forEach(function(ticker, idx) {\n                if (idx !== 0) {\n                    targets[idx] = Math.round(targets[0] * risk_factors[ticker_set[0]] / risk_factors[ticker])\n                }\n            })\n\n            // for each ticker, use its target to derive the other metrics\n            ticker_set.forEach(function(ticker, idx) {\n                if (!new_whatif.values.hasOwnProperty(ticker)) {\n                    new_whatif.values[ticker] = {}\n                }\n                let original_currentvalue = self.getCurrentValue(ticker)\n                let original_basis = self.getBasis(ticker)\n                let value_delta, target = targets[idx]\n\n                // for values, \"target\" is the target market value for this position\n                if (balance_target_column === 'value_at_risk') {\n\n                    let whatif_currentshares = Math.floor(target / self.state.allCurrentQuotes[ticker].current_price)\n                    new_whatif.values[ticker]['current_shares'] = whatif_currentshares\n\n                    let whatif_balancedvalue = whatif_currentshares * self.state.allCurrentQuotes[ticker].current_price\n                    new_whatif.values[ticker]['current_value'] = whatif_balancedvalue\n\n                    value_delta = whatif_balancedvalue - original_currentvalue\n                    let whatif_basis = original_basis + value_delta\n                    if (whatif_basis < 0) {\n                        whatif_basis = 0\n                    }\n                    new_whatif.values[ticker]['basis'] = whatif_basis\n                    new_whatif.values[ticker]['basis_risked'] = whatif_basis * risk_factors[ticker]\n\n                    new_whatif.values[ticker]['value_at_risk'] = whatif_balancedvalue * risk_factors[ticker]\n\n                // for bases, \"target\" is the target basis for this position\n                } else if (balance_target_column === 'basis_risked') {\n\n                    let original_currentshares = self.getCurrentShares(ticker)\n                    let target_delta = target - original_basis\n                    let target_delta_shares\n                    if (target_delta >= 0) {\n                        target_delta_shares = Math.floor(target_delta / self.state.allCurrentQuotes[ticker].current_price)\n                    } else {\n                        target_delta_shares = Math.ceil(target_delta / self.state.allCurrentQuotes[ticker].current_price)\n                    }\n                    let whatif_currentshares = original_currentshares + target_delta_shares\n                    new_whatif.values[ticker]['current_shares'] = whatif_currentshares\n\n                    let whatif_balancedbasis = original_basis + target_delta_shares * self.state.allCurrentQuotes[ticker].current_price\n                    if (whatif_balancedbasis < 0) {\n                        whatif_balancedbasis = 0\n                    }\n                    new_whatif.values[ticker]['basis'] = whatif_balancedbasis\n                    new_whatif.values[ticker]['basis_risked'] = whatif_balancedbasis * risk_factors[ticker]\n    \n                    value_delta = whatif_balancedbasis - original_basis\n                    new_whatif.values[ticker]['current_value'] = original_currentvalue + value_delta\n    \n                    new_whatif.values[ticker]['value_at_risk'] = new_whatif.values[ticker]['current_value'] * risk_factors[ticker]\n                }\n\n                if (adjusting_cash) {\n                    actual_remaining_cash -= value_delta \n                }\n            })\n        }\n\n        if (adjusting_cash) {\n            new_whatif.values['cash'] = {}\n            new_whatif.values['cash']['current_shares'] = actual_remaining_cash\n            new_whatif.values['cash']['current_value'] = actual_remaining_cash\n            new_whatif.values['cash']['basis'] = actual_remaining_cash\n            new_whatif.values['cash']['value_at_risk'] = 0\n        }\n        this.setState({ allWhatifs: new_whatif.values, balance_target_column: new_whatif.balance_target_column })\n    }\n\n    getHoldings() {\n        return Object.entries(this.state.allPositions).filter(holding => holding[1]['current_shares'] > 0).map(holding => holding[0])\n    }\n\n    getIndicies() {\n        return [...this.state.allIndiciesAliases]\n    }\n\n    getAdded() {\n        let added_tickers = []\n        let self = this\n        Object.keys(this.state.allTags).forEach(function(tag) {\n            added_tickers = added_tickers.concat(self.state.allTags[tag])\n        })\n        return Array.from(new Set(added_tickers))\n    }\n\n    getTagged() {\n        let tagged_tickers = []\n        let self = this\n        Object.keys(this.state.allTags).forEach(function(tag) {\n            if (tag !== 'untagged') {\n                tagged_tickers = tagged_tickers.concat(self.state.allTags[tag])\n            }\n        })\n        return Array.from(new Set(tagged_tickers))\n    }\n\n    getUntagged() {\n        return Array.from(this.state.allTags['untagged'])\n    }\n\n    populateSymbolCount(grid_rows) {\n        if (this.state.show_index) {\n            grid_rows -= 1\n        }\n        if (this.state.show_cash) {\n            grid_rows -= 1\n        }\n        if (grid_rows) {\n            return '(' + grid_rows + ')'\n        } else {\n            return ''\n        }\n    }\n\n    nameIsAnAggregate(name) {\n        return Object.keys(this.state.allTags).includes(name)\n    }\n\n    nameIsSpecial(name) {\n        if (name === 'cash') {\n            return true\n        } else if (name === 'S&P500') {\n            return true\n        } else {\n            return false\n        }\n    }\n\n    sortTickers(names_list) {\n\n        let sort_column = this.state.sort_column\n        let quote_columns = ['current_price', 'change_pct', 'quote_date', 'volume', 'dollar_volume']\n        let holdings_columns = ['start_date', 'current_shares', 'current_value', 'percent_value', 'value_at_risk', 'basis', 'basis_risked', 'realized_gains', 'percent_basis', 'percent_profit']\n        let performance_columns = ['short_change_pct', 'medium_change_pct', 'long_change_pct']\n\n        let sorted_names_list = [...names_list]\n        let self = this\n        sorted_names_list.sort(function(a,b) {\n            let value_a, value_b\n\n            // pin certain names to the top, regardless of the user sort\n            if (sort_column === 'symbol') {\n                if (a === 'untagged') {\n                    return -1\n                } else if (b === 'untagged') {\n                    return 1\n                } else if (a === 'S&P500') {\n                    return -1\n                } else if (b === 'S&P500') {\n                    return 1\n                } else if (a === 'cash') {\n                    return -1\n                } else if (b === 'cash') {\n                    return 1\n                }\n                value_a = a\n                value_b = b\n\n            // sort by a quote column\n            } else if (quote_columns.includes(sort_column)) {\n                if (self.nameIsAnAggregate(a) || !self.state.allCurrentQuotes.hasOwnProperty(a)) {\n                    value_a = 'n/a'\n                } else {\n                    if (sort_column === 'dollar_volume') {\n                        value_a = self.state.allCurrentQuotes[a]['current_price'] * self.state.allCurrentQuotes[a]['volume']\n                    } else {\n                        value_a = self.state.allCurrentQuotes[a][sort_column]\n                    }\n                }\n                if (self.nameIsAnAggregate(b) || !self.state.allCurrentQuotes.hasOwnProperty(b)) {\n                    value_b = 'n/a'\n                } else {\n                    if (sort_column === 'dollar_volume') {\n                        value_b = self.state.allCurrentQuotes[b]['current_price'] * self.state.allCurrentQuotes[b]['volume']\n                    } else {\n                        value_b = self.state.allCurrentQuotes[b][sort_column]\n                    }\n                }\n\n            // sort by a performance column\n            } else if (performance_columns.includes(sort_column)) {\n                if (self.nameIsAnAggregate(a) && self.state.aggrPerformance.hasOwnProperty(a)) {\n                    value_a = self.state.aggrPerformance[a][sort_column]\n                } else if (!self.nameIsAnAggregate(a) && self.state.allPerformanceNumbers.hasOwnProperty(a)) {\n                    value_a = self.state.allPerformanceNumbers[a][sort_column]\n                } else {\n                    value_a = 'n/a'\n                }\n                if (self.nameIsAnAggregate(b) && self.state.aggrPerformance.hasOwnProperty(b)) {\n                    value_b = self.state.aggrPerformance[b][sort_column]\n                } else if (!self.nameIsAnAggregate(b) && self.state.allPerformanceNumbers.hasOwnProperty(b)) {\n                    value_b = self.state.allPerformanceNumbers[b][sort_column]\n                } else {\n                    value_b = 'n/a'\n                }\n\n            // sort by a holdings column\n            } else if (holdings_columns.includes(sort_column)) {\n                let positionvalue_a, positionvalue_b, basis_a, basis_b\n                if (self.nameIsAnAggregate(a)) {\n                    switch(sort_column) {\n                        case 'current_shares':\n                            value_a = 'n/a'\n                            break;\n                        case 'current_value':\n                        case 'percent_value':\n                            value_a = self.state.aggrTotalValue[a]\n                            break;\n                        case 'basis':\n                        case 'percent_basis':\n                            value_a = self.state.aggrBasis[a]\n                            break;\n                        case 'realized_gains':\n                            value_a = self.state.aggrRealized[a]\n                            break;\n                        case 'percent_profit':\n                            positionvalue_a = self.state.aggrTotalValue[a]\n                            basis_a = self.state.aggrBasis[a]\n                            if (isNaN(positionvalue_a) || isNaN(basis_a)) {\n                                value_a = 'n/a' \n                            } else if (positionvalue_a !== 0) {\n                                value_a = (basis_a >= 0) ? 1 - (basis_a / positionvalue_a) : 'losing'\n                            } else {\n                                value_a = positionvalue_a\n                            }\n                            break;\n                        default:\n                            value_a = 'n/a'\n                    }\n                } else if (self.state.allPositions.hasOwnProperty(a)) {\n                    if (sort_column === 'current_value' || sort_column === 'percent_value' || sort_column === 'percent_profit' || sort_column === 'value_at_risk') {\n                        if (self.state.allCurrentQuotes.hasOwnProperty(a)) {\n                            positionvalue_a = self.state.allPositions[a]['current_shares'] * self.state.allCurrentQuotes[a]['current_price']\n                            if (sort_column === 'percent_profit' && positionvalue_a !== 0) {\n                                basis_a = self.state.allPositions[a]['basis']\n                                value_a = (basis_a >= 0) ? 1 - (basis_a / positionvalue_a) : 'losing'\n                            } else if (sort_column === 'value_at_risk' && positionvalue_a !== 0 && self.state.allRisk.hasOwnProperty(a)) {\n                                value_a = positionvalue_a * self.state.allRisk[a].factor\n                            } else {\n                                value_a = positionvalue_a\n                            }\n                        } else {\n                            value_a = 'n/a'\n                        }\n                    } else if (self.state.allPositions[a]['current_shares']) {\n                        if (sort_column === 'basis_risked' && self.state.allRisk.hasOwnProperty(a)) {\n                            value_a = self.state.allPositions[a]['basis'] * self.state.allRisk[a]['factor']\n                        } else if (sort_column === 'percent_basis') {\n                            value_a = self.state.allPositions[a]['basis']\n                        } else {\n                            value_a = self.state.allPositions[a][sort_column]\n                        }\n                    } else {\n                        value_a = 'n/a'\n                    }\n                } else {\n                    value_a = 'n/a'\n                }\n                if (self.nameIsAnAggregate(b)) {\n                    switch(sort_column) {\n                        case 'current_shares':\n                            value_b = 'n/a'\n                            break;\n                        case 'current_value':\n                        case 'percent_value':\n                            value_b = self.state.aggrTotalValue[b]\n                            break;\n                        case 'basis':\n                        case 'percent_basis':\n                            value_b = self.state.aggrBasis[b]\n                            break;\n                        case 'realized_gains':\n                            value_b = self.state.aggrRealized[b]\n                            break;\n                        case 'percent_profit':\n                            positionvalue_b = self.state.aggrTotalValue[b]\n                            basis_b = self.state.aggrBasis[b]\n                            if (isNaN(positionvalue_b) || isNaN(basis_b)) {\n                                value_b = 'n/a' \n                            } else if (positionvalue_b !== 0) {\n                                value_b = (basis_b >= 0) ? 1 - (basis_b / positionvalue_b) : 'losing'\n                            } else {\n                                value_b = positionvalue_b\n                            }\n                            break;\n                        default:\n                            value_b = 'n/a'\n                    }\n                } else if (self.state.allPositions.hasOwnProperty(b)) {\n                    if (sort_column === 'current_value' || sort_column === 'percent_value' || sort_column === 'percent_profit' || sort_column === 'value_at_risk') {\n                        if (self.state.allCurrentQuotes.hasOwnProperty(b)) {\n                            positionvalue_b = self.state.allPositions[b]['current_shares'] * self.state.allCurrentQuotes[b]['current_price']\n                            if (sort_column === 'percent_profit' && positionvalue_b !== 0) {\n                                basis_b = self.state.allPositions[b]['basis']\n                                value_b = (basis_b >= 0) ? 1 - (basis_b / positionvalue_b) : 'losing'\n                            } else if (sort_column === 'value_at_risk' && positionvalue_b !== 0 && self.state.allRisk.hasOwnProperty(b)) {\n                                value_b = positionvalue_b * self.state.allRisk[b].factor\n                            } else {\n                                value_b = positionvalue_b\n                            }\n                        } else {\n                            value_b = 'n/a'\n                        }\n                    } else if (self.state.allPositions[b]['current_shares']) {\n                        if (sort_column === 'basis_risked' && self.state.allRisk.hasOwnProperty(b)) {\n                            value_b = self.state.allPositions[b]['basis'] * self.state.allRisk[b]['factor']\n                        } else if (sort_column === 'percent_basis') {\n                            value_b = self.state.allPositions[b]['basis']\n                        } else {\n                            value_b = self.state.allPositions[b][sort_column]\n                        }\n                    } else {\n                        value_b = 'n/a'\n                    }\n                } else {\n                    value_b = 'n/a'\n                }\n\n            // miscelaneous columns\n            } else if (sort_column === 'risk_factor') {\n                value_a = (self.state.allRisk.hasOwnProperty(a)) ? self.state.allRisk[a].factor : (a === 'cash') ? 0 : 0.20\n                value_b = (self.state.allRisk.hasOwnProperty(b)) ? self.state.allRisk[b].factor : (b === 'cash') ? 0 : 0.20\n\n            } else if (sort_column === 'risk_factor_modified') {\n                value_a = (self.state.allRisk.hasOwnProperty(a)) ? self.state.allRisk[a].modified_at : 'n/a'\n                value_b = (self.state.allRisk.hasOwnProperty(b)) ? self.state.allRisk[b].modified_at : 'n/a'\n\n            // default, do not reorder this pair\n            } else {\n                return 0\n            }\n                \n            if (value_a === value_b) {\n                return 0\n            }\n            if (self.state.sort_dir_asc === true) {\n                if (value_a === 'n/a') {\n                    return 1\n                } else if (value_b === 'n/a') {\n                    return -1\n                } else if (value_a < value_b) {\n                    return -1\n                } else if (value_a > value_b) {\n                    return 1\n                }\n            } else {\n                if (value_a === 'n/a') {\n                    return 1\n                } else if (value_b === 'n/a') {\n                    return -1\n                } else if (value_a < value_b) {\n                    return 1\n                } else if (value_a > value_b) {\n                    return -1\n                }\n            }\n            return 0\n        })\n\n        return sorted_names_list\n    }\n\n    render() {\n\n        let self = this\n\n        let tickers_to_show = []\n        if (this.state.done) {\n            if (this.state.show_index) {\n                tickers_to_show = [...tickers_to_show, ...this.getIndicies()]\n            }\n            if (this.state.show_holdings) {\n                tickers_to_show = [...tickers_to_show, ...this.getHoldings()].filter(ticker => ticker !== 'cash')\n            }\n            if (this.state.show_cash) {\n                tickers_to_show.push('cash')\n            }\n            if (this.state.show_tagged) {\n                tickers_to_show = [...tickers_to_show, ...this.getTagged()]\n            }\n            if (this.state.show_untagged) {\n                tickers_to_show = [...tickers_to_show, ...this.getUntagged()]\n            }\n        }\n        let unique_tickers_to_show = Array.from(new Set(tickers_to_show))\n        let sort_triangle = (this.state.sort_dir_asc === true) ? String.fromCharCode(9650) : String.fromCharCode(9660)\n        let sorted_tickers = this.sortTickers(unique_tickers_to_show)\n\n        let row_data = {}\n        sorted_tickers.forEach(function(ticker) {\n\n            row_data[ticker] = {}\n\n            let tag_membership = []\n            Object.entries(self.state.allTags).forEach(function(tag_info) {\n                if (tag_info[1].includes(ticker)) {\n                    tag_membership.push(tag_info[0])\n                }\n            })\n            row_data[ticker]['tags'] = tag_membership\n\n            let special_classes = []\n            if (self.tickerIsIndex(ticker)) {\n                special_classes.push('index')\n            }\n            if (ticker === 'cash') {\n                special_classes.push('cash')\n            }\n            row_data[ticker]['special_classes'] = special_classes\n\n            if (self.state.allPositions.hasOwnProperty(ticker)) {\n                row_data[ticker]['start_date'] = self.state.allPositions[ticker].start_date\n                row_data[ticker]['basis'] = self.state.allPositions[ticker].basis\n                row_data[ticker]['current_shares'] = self.state.allPositions[ticker].current_shares\n                row_data[ticker]['realized_gains'] = self.state.allPositions[ticker].realized_gains\n            } else {\n                row_data[ticker]['start_date'] = 'n/a'\n                row_data[ticker]['basis'] = 'n/a'\n                row_data[ticker]['current_shares'] = 'n/a'\n                row_data[ticker]['realized_gains'] = 'n/a'\n            }\n\n            if (self.state.allWhatifs.hasOwnProperty(ticker)) {\n                row_data[ticker]['whatif'] = self.state.allWhatifs[ticker]\n\n            } else {\n                row_data[ticker]['whatif'] = null\n            }\n        })\n\n        let sorted_aggr_tickers = this.sortTickers(Object.keys(this.state.allTags).filter(ticker => !(ticker === 'untagged' && !this.state.allTags.untagged.length)))\n        let aggr_row_data = {}\n        sorted_aggr_tickers.forEach(function(aggr_ticker) {\n\n            let new_aggr_data = {}\n\n            new_aggr_data['symbol'] = aggr_ticker\n            new_aggr_data['tags'] = []\n            new_aggr_data['special_classes'] = ['aggregate']\n            new_aggr_data['basis'] = 'n/a'\n            new_aggr_data['start_date'] = 'n/a'\n            new_aggr_data['current_shares'] = 'n/a'\n            new_aggr_data['current_price'] = 'n/a'\n            new_aggr_data['current_value'] = self.state.aggrTotalValue[aggr_ticker]\n            new_aggr_data['change_pct'] = 'n/a'\n            new_aggr_data['volume'] = 'n/a'\n            new_aggr_data['basis'] = self.state.aggrBasis[aggr_ticker]\n            new_aggr_data['realized_gains'] = self.state.aggrRealized[aggr_ticker]\n            new_aggr_data['performance'] = self.state.aggrPerformance[aggr_ticker]\n            new_aggr_data['whatif'] = null\n\n            aggr_row_data[aggr_ticker] = new_aggr_data\n        })\n\n        let shown_column_names = this.state.shown_columns.map(column => column.name)\n        let all_columns_namesorted = JSON.parse(JSON.stringify(all_columns)).sort(function (a,b) {\n            let value_a = a.display_name\n            if (value_a.includes('year')) {\n                value_a = '0' + value_a\n            } else if (value_a.includes('month')) {\n                value_a = '00' + value_a\n            }\n            let value_b = b.display_name\n            if (value_b.includes('year')) {\n                value_b = '0' + value_b\n            } else if (value_b.includes('month')) {\n                value_b = '00' + value_b\n            }\n            if (value_a < value_b) {\n                return -1\n            } else if (value_a < value_b) {\n                return 1\n            } else {\n                return 0\n            }\n        })\n\n        const row_popover = (\n            <Popover id=\"popover-basic\">\n                <Popover.Title as=\"h3\">included rows:</Popover.Title>\n                <Popover.Content>\n                <div id=\"row-control\">\n                    <form>\n                        <div className=\"switch_controls\">\n\n                            <div className=\"switch_control\">\n                                <div className=\"switch_label\">show holdings:</div>\n                                <div className=\"switch_wrapper\">\n                                    <input id=\"show_holdings\" name=\"show_holdings\" type=\"checkbox\" checked={this.state.show_holdings} onChange={this.onShowInputChange} />\n                                    <label htmlFor=\"show_holdings\" className=\"switch\"></label>\n                                </div>\n                            </div>\n\n                            <div className=\"switch_control\">\n                                <div className=\"switch_label\">show tagged:</div>\n                                <div className=\"switch_wrapper\">\n                                    <input id=\"show_tagged\" name=\"show_tagged\" type=\"checkbox\" checked={this.state.show_tagged} onChange={this.onShowInputChange} />\n                                    <label htmlFor=\"show_tagged\" className=\"switch\"></label>\n                                </div>\n                            </div>\n\n                            <div className=\"switch_control\">\n                                <div className=\"switch_label\">show untagged:</div>\n                                <div className=\"switch_wrapper\">\n                                    <input id=\"show_untagged\" name=\"show_untagged\" type=\"checkbox\" checked={this.state.show_untagged} onChange={this.onShowInputChange} />\n                                    <label htmlFor=\"show_untagged\" className=\"switch\"></label>\n                                </div>\n                            </div>\n\n                            <div className=\"switch_control\">\n                                <div className=\"switch_label\">show index:</div>\n                                <div className=\"switch_wrapper\">\n                                    <input id=\"show_index\" name=\"show_index\" type=\"checkbox\" checked={this.state.show_index} onChange={this.onShowInputChange} />\n                                    <label htmlFor=\"show_index\" className=\"switch\"></label>\n                                </div>\n                            </div>\n\n                            <div className=\"switch_control\">\n                                <div className=\"switch_label\">show cash:</div>\n                                <div className=\"switch_wrapper\">\n                                    <input id=\"show_cash\" name=\"show_cash\" type=\"checkbox\" checked={this.state.show_cash} onChange={this.onShowInputChange} />\n                                    <label htmlFor=\"show_cash\" className=\"switch\"></label>\n                                </div>\n                            </div>\n\n                            <div className=\"switch_control\">\n                                <div className=\"switch_label\">show aggregates (tags):</div>\n                                <div className=\"switch_wrapper\">\n                                    <input id=\"show_aggregates\" name=\"show_aggregates\" type=\"checkbox\" checked={this.state.show_aggregates} onChange={this.onShowInputChange} />\n                                    <label htmlFor=\"show_aggregates\" className=\"switch\"></label>\n                                </div>\n                            </div>\n\n                        </div>\n                    </form>\n                </div>\n                </Popover.Content>\n            </Popover>\n        )\n        const RowSettings = () => (\n            <OverlayTrigger trigger=\"click\" placement=\"left\" overlay={row_popover}>\n                <button className=\"btn btn-sm btn-secondary\" variant=\"success\">&#x2699; Rows</button>\n            </OverlayTrigger>\n        )\n        const column_popover = (\n            <Popover id=\"popover-basic\">\n                <Popover.Title as=\"h3\">included columns:</Popover.Title>\n                <Popover.Content>\n                <div id=\"column-control\">\n                    {all_columns_namesorted.map(column => (\n                        <span key={ column.name } onClick={ (e)=>this.onToggleShowColumn(column.name) } className={!shown_column_names.includes(column.name) ? 'strikethrough' : ''}>{ column.display_name }</span>\n                    ))}\n                </div>\n                </Popover.Content>\n            </Popover>\n        )\n        const ColumnSettings = () => (\n            <OverlayTrigger trigger=\"click\" placement=\"left\" overlay={column_popover}>\n                <button className=\"btn btn-sm btn-secondary\" variant=\"success\">&#x2699; Columns</button>\n            </OverlayTrigger>\n        )\n        \n        const PopulateHeaderRow = ({is_aggregate, highlight_column}) => (\n            <GridHeaderRow\n                highlight_column={highlight_column}\n                is_aggregate={is_aggregate}\n                columns={this.state.shown_columns}\n                symbol_count_str={symbol_count}\n                sort_column={this.state.sort_column}\n                sort_triangle={sort_triangle}\n                whatif_format={this.state.whatif_format}\n                on_change_sort={this.onChangeSort}\n                on_change_whatif_format={this.onChangeWhatifFormat}\n            />\n        )\n\n        const PopulateRow = ({row_data}) => (\n            <GridRow \n                key={row_data.row_name}\n                is_aggregate={row_data.is_aggregate}\n                row_name={row_data.row_name}\n                membership_set={row_data.membership_set}\n                columns={row_data.columns}\n                special_classes={row_data.special_classes}\n                current_price={row_data.current_price}\n                change_pct={row_data.change_pct}\n                quote_date={row_data.quote_date}\n                volume={row_data.volume}\n                basis={row_data.basis}\n                start_date={row_data.start_date}\n                current_shares={(this.state.show_holdings) ? row_data.current_shares : 'n/a'}\n                current_value={(this.state.show_holdings) ? row_data.current_value : 'n/a'}\n                realized_gains={(this.state.show_holdings) ? row_data.realized_gains : 'n/a'}\n                risk_factor={row_data.risk_factor}\n                risk_factor_modified={row_data.risk_factor_modified}\n                performance_numbers={row_data.performance_numbers}\n                show_only_achieved_performance={this.state.show_only_achieved_performance}\n                baseline={row_data.baseline}\n                style_realized_performance={row_data.style_realized_performance}\n                total_value={(this.state.show_holdings) ? row_data.total_value : 'n/a'}\n                total_basis={(this.state.show_holdings) ? row_data.total_basis : 'n/a'}\n                whatif={row_data.whatif}\n                whatif_format={this.state.whatif_format}\n                on_change_whatif_format={this.onChangeWhatifFormat}\n                on_remove_from_tag={row_data.on_remove_from_tag}\n                on_delete_ticker={row_data.on_delete_ticker}\n                on_delete_tag={row_data.on_delete_tag}\n                editing_row={this.state.editing_row}\n                current_edit_value={(typeof this.state.editing_row === 'string' && this.state.allRisk.hasOwnProperty(this.state.editing_row)) ? this.state.allRisk[this.state.editing_row].factor : ''}\n                on_edit_cell={row_data.on_edit_cell}\n                on_modify_risk_factor={row_data.on_modify_risk_factor}\n                on_escape_key={this.onEscapeKey}\n            />\n        )\n\n        let all_row_data = []\n        sorted_tickers.forEach(function(ticker) {\n            let new_row = {}\n            new_row['is_aggregate'] = false\n            new_row['row_name'] = ticker\n            new_row['membership_set'] = row_data[ticker]['tags']\n            new_row['columns'] = self.state.shown_columns\n            new_row['special_classes'] = row_data[ticker]['special_classes']\n            new_row['current_price'] = self.state.allCurrentQuotes[ticker].current_price\n            new_row['change_pct'] = self.state.allCurrentQuotes[ticker].change_pct\n            new_row['quote_date'] = (ticker !== 'cash' && !self.getIndicies().includes(ticker)) ? self.state.allCurrentQuotes[ticker].quote_date : 'n/a'\n            new_row['volume'] = self.state.allCurrentQuotes[ticker].volume\n            new_row['basis'] = row_data[ticker]['basis']\n            new_row['start_date'] = row_data[ticker]['start_date']\n            new_row['current_shares'] = row_data[ticker]['current_shares']\n            new_row['current_value'] = (new_row.current_price === 'n/a' || new_row.current_shares === 'n/a') ? 'n/a' : new_row.current_price * new_row.current_shares\n            new_row['realized_gains'] = row_data[ticker]['realized_gains']\n            new_row['risk_factor'] = (self.state.allRisk.hasOwnProperty(ticker)) ? self.state.allRisk[ticker].factor : null\n            new_row['risk_factor_modified'] = (self.state.allRisk.hasOwnProperty(ticker)) ? self.state.allRisk[ticker].modified_at : null\n            new_row['performance_numbers'] = self.state.allPerformanceNumbers[ticker]\n            new_row['baseline'] = self.state.baseline\n            new_row['style_realized_performance'] = (Object.entries(self.state.allPositions).filter(position => position[0] !== 'cash' && position[1].current_shares).length) ? true : false\n            new_row['total_value'] = self.state.aggrTotalValue['_everything_']\n            new_row['total_basis'] = self.state.aggrBasis['_everything_']\n            new_row['whatif'] = row_data[ticker]['whatif']\n            new_row['on_remove_from_tag'] = self.onRemoveFromTag\n            new_row['on_delete_ticker'] = self.onDeleteTicker\n            new_row['on_delete_tag'] = self.onDeleteTag\n            new_row['on_edit_cell'] = self.onEditCell\n            new_row['on_modify_risk_factor'] = self.onModifyRiskFactor\n            all_row_data.push(new_row)\n        })\n        if (this.state.show_aggregates) {\n            sorted_aggr_tickers.forEach(function(aggr_ticker) {\n                let new_row = {}\n                new_row['is_aggregate'] = true\n                new_row['row_name'] = aggr_ticker\n                new_row['membership_set'] = self.state.allTags[aggr_ticker]\n                new_row['columns'] = self.state.shown_columns\n                new_row['special_classes'] = aggr_row_data[aggr_ticker]['special_classes']\n                new_row['current_price'] = aggr_row_data[aggr_ticker]['current_price']\n                new_row['change_pct'] = aggr_row_data[aggr_ticker]['change_pct']\n                new_row['quote_date'] = 'n/a'\n                new_row['volume'] = aggr_row_data[aggr_ticker]['volume']\n                new_row['basis'] = self.state.aggrBasis[aggr_ticker]\n                new_row['start_date'] = aggr_row_data[aggr_ticker]['start_date']\n                new_row['current_shares'] = aggr_row_data[aggr_ticker]['current_shares']\n                new_row['current_value'] = aggr_row_data[aggr_ticker]['current_value']\n                new_row['realized_gains'] = aggr_row_data[aggr_ticker]['realized_gains']\n                new_row['risk_factor'] = 'n/a'\n                new_row['risk_factor_modified'] = 'n/a'\n                new_row['performance_numbers'] = aggr_row_data[aggr_ticker]['performance']\n                new_row['baseline'] = self.state.baseline\n                new_row['style_realized_performance'] = false\n                new_row['total_value'] = self.state.aggrTotalValue['_everything_']\n                new_row['total_basis'] = self.state.aggrBasis['_everything_']\n                new_row['whatif'] = aggr_row_data[aggr_ticker]['whatif']\n                new_row['on_remove_from_tag'] = self.onRemoveFromTag\n                new_row['on_delete_ticker'] = self.onDeleteTicker\n                new_row['on_delete_tag'] = self.onDeleteTag\n                new_row['on_edit_cell'] = self.onEditCell\n                new_row['on_modify_risk_factor'] = self.onModifyRiskFactor\n                all_row_data.push(new_row)\n            })\n        }\n\n        let symbol_count = this.populateSymbolCount(sorted_tickers.length) \n\n        return (\n            <div id=\"page-wrapper\">\n                <div id=\"page-controls\">\n                    <div id=\"left-side\">\n                        <div id=\"input-controls\">\n                            <InputForms\n                                all_stocks={this.state.allStocks}\n                                all_tags={this.state.allTags}\n                                all_current_quotes={this.state.allCurrentQuotes}\n                                all_monthly_quotes={this.state.allMonthlyQuotes}\n                                all_positions={this.state.allPositions}\n                                all_transactions={this.state.allTransactions}\n                                all_risk={this.state.allRisk}\n                                show_holdings={this.state.show_holdings}\n                                show_tagged={this.state.show_tagged}\n                                show_untagged={this.state.show_untagged}\n                                show_cash={this.state.show_cash}\n                                baseline={this.state.baseline.name}\n                                get_balanceable_value={this.getBalanceableValue}\n                                on_new_tickers={this.onNewTickers}\n                                on_new_tags={this.onNewTags}\n                                on_delete_tag={this.onDeleteTag}\n                                on_delete_transaction={this.onDeleteTransaction}\n                                on_new_transaction={this.onNewTransaction}\n                                on_import_transactions={this.onImportTransactions}\n                                on_new_cash={this.onNewCash}\n                                create_message={this.createMessage}\n                                all_status_messages={this.state.all_status_messages}\n                                on_new_messages={this.onNewMessages}\n                                on_whatif_submit={this.onWhatifSubmit}\n                            />\n                        </div>\n                        <div id=\"last-status-messages\">\n                            {this.state.last_error_messages.map( (status_message,i) => (\n                                <div key={i + status_message.modified_at}>{status_message.content}</div>\n                            ))}\n                        </div>\n                    </div>\n                    <div id=\"view-controls\">\n                        <div id=\"baseline-control\">\n                            <label htmlFor=\"baseline\">Performance Baseline:</label>\n                            <select id=\"baseline\" name=\"baseline\" value={this.state.baseline.name} onChange={this.onInputChange}>\n                                <option value=\"zero_pct_gain\">0% gain</option>\n                                <option value=\"sp500_pct_gain\">SP&amp;500 Index</option>\n                            </select>\n                        </div>\n                        <div id=\"performance_controls\">\n                            <div className=\"switch_control\">\n                                <div className=\"switch_label\">show performance only if achieved:</div>\n                                <div className=\"switch_wrapper\">\n                                    <input id=\"show_only_achieved_performance\" name=\"show_only_achieved_performance\" type=\"checkbox\" checked={this.state.show_only_achieved_performance} onChange={this.onShowInputChange} />\n                                    <label htmlFor=\"show_only_achieved_performance\" className=\"switch\"></label>\n                                </div>\n                            </div>\n                        </div>\n                        <div id=\"page-settings\">\n                            <RowSettings />\n                            <ColumnSettings />\n                        </div>\n\n                    </div>\n                </div>\n                <table id=\"position-listing\" cellSpacing=\"0\">\n                    <thead>\n                        <PopulateHeaderRow is_aggregate={false} highlight_column={this.state.balance_target_column} />\n                        <PopulateHeaderRow is_aggregate={false} highlight_column={null} />\n                    </thead>\n                    <tbody>\n                        {this.state.done && all_row_data.filter(row_data => !row_data.is_aggregate).map(row_data => (\n                            <PopulateRow key={row_data.row_name} row_data={row_data} />\n                        ))}\n                        <GridRowTotals\n                            columns={this.state.shown_columns}\n                            total_value={this.state.aggrTotalValue['_everything_']}\n                            total_basis={this.state.aggrBasis['_everything_']}\n                            total_performance={this.state.aggrPerformance['_everything_']}\n                        />\n                    </tbody>\n                </table>\n                {this.state.done && this.state.show_aggregates && (\n                    <table id=\"aggr-position-listing\" cellSpacing=\"0\">\n                        <thead>\n                            <PopulateHeaderRow is_aggregate={true} highlight_column={null} />\n                        </thead>\n                        <tbody>\n                            {this.state.done && all_row_data.filter(row_data => row_data.is_aggregate).map(row_data => (\n                                <PopulateRow key={row_data.row_name} row_data={row_data} />\n                            ))}\n                        </tbody>\n                    </table>\n                )}\n            </div>\n        )\n    }\n\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport { ComparingStocks } from './ComparingStocks'\n\nReactDOM.render(<ComparingStocks />, document.getElementById('root'));\n"],"sourceRoot":""}